PROMPT REFINADO: CARDS ESTÃTICOS NO CHAT (INSPIRADO EM MANUS IA)
OBJETIVO
Implementar comportamento de cards estÃ¡ticos posicionados no fluxo do chat, onde tanto o Card de Plano de AÃ§Ã£o quanto o Card de Modo Desenvolvedor permanecem fixos em suas posiÃ§Ãµes originais, e todas as mensagens subsequentes da IA aparecem abaixo deles, criando um fluxo de conversa natural e organizado.

ANÃLISE DAS IMAGENS (REFERÃŠNCIA VISUAL)
Imagem 1 - Fluxo Inicial:
UsuÃ¡rio: "Preciso que vocÃª escolha as melhores atividades para eu fazer e crie elas"

IA: "Ã“timo! Entendi o que vocÃª precisa. Montei um plano de aÃ§Ã£o com 3 etapas..."

IA: "Vou executar o seu plano de aÃ§Ã£o agora"

IA: "Iniciando execuÃ§Ã£o do plano com 3 etapas..."

IA: RelatÃ³rio de Atividades Personalizadas (comeÃ§ando a aparecer)

Imagem 2 - Modo Desenvolvedor Ativo:
MODO DESENVOLVEDOR (card fixo)

âœ“ Pesquisar atividades disponÃ­veis - ConcluÃ­do

âœ“ Escolher as melhores atividades - ConcluÃ­do

âœ“ Criar as atividades - ConcluÃ­do

Badge inferior: "Vou pesquisar as atividades disponÃ­veis na plataforma" (1/3)

Input de mensagem abaixo

Comportamento esperado: Cards ficam "ancorados" em suas posiÃ§Ãµes no histÃ³rico do chat.

COMPORTAMENTO ESPERADO (INSPIRADO EM MANUS IA)
Fluxo Visual Completo:
text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUÃRIO (azul, direita)                     â”‚
â”‚ "Criar 3 atividades de Ã¡lgebra"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IA (cinza escuro, esquerda)                 â”‚
â”‚ "Ã“timo! Entendi o que vocÃª precisa.        â”‚
â”‚  Montei um plano de aÃ§Ã£o com 3 etapas:"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CARD DE PLANO DE AÃ‡ÃƒO (estÃ¡tico)           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ¤– Plano de AÃ§Ã£o                    â”‚    â”‚
â”‚ â”‚ â—‹ Pesquisar atividades              â”‚    â”‚
â”‚ â”‚ â—‹ Decidir quais criar               â”‚    â”‚
â”‚ â”‚ â—‹ Criar as atividades               â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ [APLICAR PLANO] [EDITAR PLANO]     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (usuÃ¡rio clica APLICAR PLANO)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IA (cinza escuro, esquerda)                 â”‚
â”‚ "Vou executar o seu plano de aÃ§Ã£o agora"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CARD MODO DESENVOLVEDOR (estÃ¡tico)         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ› ï¸ MODO DESENVOLVEDOR              â”‚    â”‚
â”‚ â”‚              [âš¡ Em execuÃ§Ã£o]        â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ â—‰ Pesquisar atividades              â”‚    â”‚
â”‚ â”‚   â””â”€ ğŸ“Š Pesquisando...              â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IA (cinza escuro, esquerda)                 â”‚
â”‚ "Encontrei 24 atividades disponÃ­veis!"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

(Card Modo Desenvolvedor ATUALIZA internamente)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CARD MODO DESENVOLVEDOR (mesma posiÃ§Ã£o)    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ› ï¸ MODO DESENVOLVEDOR              â”‚    â”‚
â”‚ â”‚              [âš¡ Em execuÃ§Ã£o]        â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ âœ“ Pesquisar atividades (ConcluÃ­do) â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ â—‰ Decidir quais criar               â”‚    â”‚
â”‚ â”‚   â””â”€ ğŸ¯ Analisando...               â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IA (cinza escuro, esquerda)                 â”‚
â”‚ "Escolhi 3 atividades estrategicamente"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

... e assim sucessivamente
ARQUITETURA DE MENSAGENS NO CHAT
Tipos de Mensagens
typescript
// shared/types/message-types.ts

export type MessageType = 
  | 'user'           // Mensagem do usuÃ¡rio
  | 'assistant'      // Mensagem de texto da IA
  | 'plan_card'      // Card de Plano de AÃ§Ã£o (estÃ¡tico)
  | 'dev_mode_card'  // Card de Modo Desenvolvedor (estÃ¡tico)
  | 'construction_card' // Card de ConstruÃ§Ã£o de Atividades (estÃ¡tico)
  | 'system';        // Mensagens de sistema

export interface Message {
  id: string;
  type: MessageType;
  role: 'user' | 'assistant' | 'system';
  content: string | any; // string para texto, any para dados estruturados
  timestamp: number;
  
  // Metadados para cards
  metadata?: {
    cardType?: 'plan' | 'dev_mode' | 'construction';
    cardData?: any; // Dados especÃ­ficos do card
    isStatic?: boolean; // Se Ã© card estÃ¡tico
    shouldUpdate?: boolean; // Se card deve atualizar conteÃºdo interno
  };
}
IMPLEMENTAÃ‡ÃƒO DO FLUXO DE MENSAGENS
1. Estado de Mensagens no Chat
typescript
// interface-modo-producao-chat/state/chatState.ts

import { create } from 'zustand';

interface ChatState {
  messages: Message[];
  
  // Cards ativos (referÃªncias)
  activePlanCardId: string | null;
  activeDevModeCardId: string | null;
  
  // AÃ§Ãµes
  addMessage: (message: Omit<Message, 'id' | 'timestamp'>) => void;
  addPlanCard: (planData: any) => void;
  addDevModeCard: (devModeData: any) => void;
  updateCardData: (cardId: string, newData: any) => void;
  
  // Helpers
  getPlanCard: () => Message | null;
  getDevModeCard: () => Message | null;
}

export const useChatState = create<ChatState>((set, get) => ({
  messages: [],
  activePlanCardId: null,
  activeDevModeCardId: null,

  // ADICIONA MENSAGEM DE TEXTO NORMAL
  addMessage: (message) => {
    const newMessage: Message = {
      ...message,
      id: generateId(),
      timestamp: Date.now()
    };

    set((state) => ({
      messages: [...state.messages, newMessage]
    }));
  },

  // ADICIONA CARD DE PLANO (estÃ¡tico)
  addPlanCard: (planData) => {
    const planCard: Message = {
      id: generateId(),
      type: 'plan_card',
      role: 'assistant',
      content: '', // Vazio, dados estÃ£o em metadata
      timestamp: Date.now(),
      metadata: {
        cardType: 'plan',
        cardData: planData,
        isStatic: true,
        shouldUpdate: false // Plano nÃ£o atualiza apÃ³s criaÃ§Ã£o
      }
    };

    set((state) => ({
      messages: [...state.messages, planCard],
      activePlanCardId: planCard.id
    }));
  },

  // ADICIONA CARD DE MODO DESENVOLVEDOR (estÃ¡tico, mas atualizÃ¡vel)
  addDevModeCard: (devModeData) => {
    const devCard: Message = {
      id: generateId(),
      type: 'dev_mode_card',
      role: 'assistant',
      content: '',
      timestamp: Date.now(),
      metadata: {
        cardType: 'dev_mode',
        cardData: devModeData,
        isStatic: true,
        shouldUpdate: true // Dev mode atualiza internamente
      }
    };

    set((state) => ({
      messages: [...state.messages, devCard],
      activeDevModeCardId: devCard.id
    }));
  },

  // ATUALIZA DADOS INTERNOS DE UM CARD (sem mudar posiÃ§Ã£o)
  updateCardData: (cardId, newData) => {
    set((state) => ({
      messages: state.messages.map((msg) => 
        msg.id === cardId
          ? {
              ...msg,
              metadata: {
                ...msg.metadata,
                cardData: {
                  ...msg.metadata?.cardData,
                  ...newData
                }
              }
            }
          : msg
      )
    }));
  },

  // HELPERS
  getPlanCard: () => {
    const state = get();
    return state.messages.find(m => m.id === state.activePlanCardId) || null;
  },

  getDevModeCard: () => {
    const state = get();
    return state.messages.find(m => m.id === state.activeDevModeCardId) || null;
  }
}));
2. RenderizaÃ§Ã£o do Stream de Mensagens
typescript
// interface-modo-producao-chat/components/MessageStream.tsx

import { useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useChatState } from '@/state/chatState';
import { UserMessage } from './UserMessage';
import { AssistantMessage } from './AssistantMessage';
import { PlanActionCard } from './PlanActionCard';
import { DeveloperModeCard } from './DeveloperModeCard';
import { ActivityConstructionCard } from './ActivityConstructionCard';

export function MessageStream() {
  const messages = useChatState((state) => state.messages);
  const scrollRef = useRef<HTMLDivElement>(null);

  // Auto-scroll para Ãºltima mensagem
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages]);

  return (
    <div 
      ref={scrollRef}
      className="message-stream"
    >
      <AnimatePresence initial={false}>
        {messages.map((message) => (
          <motion.div
            key={message.id}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.3 }}
            className="message-container"
          >
            {/* RENDERIZA BASEADO NO TIPO */}
            {message.type === 'user' && (
              <UserMessage content={message.content} />
            )}

            {message.type === 'assistant' && (
              <AssistantMessage content={message.content} />
            )}

            {message.type === 'plan_card' && (
              <PlanActionCard 
                data={message.metadata?.cardData}
                isStatic={message.metadata?.isStatic}
              />
            )}

            {message.type === 'dev_mode_card' && (
              <DeveloperModeCard 
                cardId={message.id}
                data={message.metadata?.cardData}
                isStatic={message.metadata?.isStatic}
              />
            )}

            {message.type === 'construction_card' && (
              <ActivityConstructionCard 
                data={message.metadata?.cardData}
              />
            )}
          </motion.div>
        ))}
      </AnimatePresence>

      {/* Scroll anchor */}
      <div className="scroll-anchor" />
    </div>
  );
}
3. Card de Plano de AÃ§Ã£o (EstÃ¡tico)
typescript
// interface-modo-producao-chat/components/PlanActionCard.tsx

import { motion } from 'framer-motion';
import { useChatState } from '@/state/chatState';

interface PlanActionCardProps {
  data: {
    objetivo: string;
    etapas: Array<{
      ordem: number;
      titulo: string;
      descricao: string;
    }>;
  };
  isStatic?: boolean;
}

export function PlanActionCard({ data, isStatic = true }: PlanActionCardProps) {
  const addDevModeCard = useChatState((state) => state.addDevModeCard);
  const addMessage = useChatState((state) => state.addMessage);

  const handleApplyPlan = () => {
    // 1. ADICIONA MENSAGEM DE CONFIRMAÃ‡ÃƒO
    addMessage({
      type: 'assistant',
      role: 'assistant',
      content: 'Vou executar o seu plano de aÃ§Ã£o agora'
    });

    // 2. ADICIONA CARD DE MODO DESENVOLVEDOR (logo abaixo)
    addDevModeCard({
      plano: data,
      status: 'executando',
      etapaAtual: 0,
      etapas: data.etapas.map((e, idx) => ({
        ...e,
        status: idx === 0 ? 'executando' : 'pendente',
        capabilities: []
      }))
    });

    // 3. INICIA EXECUÃ‡ÃƒO NO BACKEND
    fetch('/api/agente-jota/execute-plan', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ planData: data })
    });
  };

  return (
    <motion.div
      layout={isStatic} // MantÃ©m posiÃ§Ã£o se estÃ¡tico
      className="plan-action-card-wrapper"
    >
      <div className="plan-card">
        {/* Header */}
        <div className="plan-header">
          <Bot className="icon" />
          <h3>Plano de AÃ§Ã£o</h3>
        </div>

        {/* Objetivo */}
        <p className="plan-objetivo">{data.objetivo}</p>

        {/* Etapas */}
        <div className="plan-etapas">
          {data.etapas.map((etapa) => (
            <div key={etapa.ordem} className="etapa-item">
              <Circle size={20} className="etapa-icon" />
              <span className="etapa-titulo">{etapa.titulo}</span>
            </div>
          ))}
        </div>

        {/* AÃ§Ãµes */}
        <div className="plan-actions">
          <button 
            className="btn-primary"
            onClick={handleApplyPlan}
          >
            APLICAR PLANO
          </button>
          <button className="btn-secondary">
            EDITAR PLANO
          </button>
        </div>
      </div>
    </motion.div>
  );
}
4. Card de Modo Desenvolvedor (EstÃ¡tico com AtualizaÃ§Ãµes Internas)
typescript
// interface-modo-producao-chat/components/DeveloperModeCard.tsx

import { useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useChatState } from '@/state/chatState';
import { useChatWebSocket } from '@/hooks/useChatWebSocket';

interface DeveloperModeCardProps {
  cardId: string; // ID da mensagem/card
  data: {
    plano: any;
    status: 'executando' | 'concluido' | 'erro';
    etapaAtual: number;
    etapas: Array<{
      titulo: string;
      status: 'pendente' | 'executando' | 'concluido';
      capabilities: CapabilityState[];
    }>;
  };
  isStatic?: boolean;
}

export function DeveloperModeCard({ cardId, data, isStatic = true }: DeveloperModeCardProps) {
  const updateCardData = useChatState((state) => state.updateCardData);
  const addMessage = useChatState((state) => state.addMessage);
  const { socket } = useChatWebSocket();

  // ATUALIZA CARD INTERNAMENTE VIA WEBSOCKET
  useEffect(() => {
    if (!socket) return;

    // Capability iniciada
    socket.on('capability:apareceu', (update) => {
      const etapaIndex = update.stepIndex;
      const novaCapability = {
        id: generateId(),
        nome: update.capability_name,
        status: 'pendente'
      };

      // Atualiza dados do card (nÃ£o muda posiÃ§Ã£o)
      updateCardData(cardId, {
        etapas: data.etapas.map((e, idx) => 
          idx === etapaIndex
            ? { ...e, capabilities: [...e.capabilities, novaCapability] }
            : e
        )
      });
    });

    socket.on('capability:iniciou', (update) => {
      updateCardData(cardId, {
        etapas: data.etapas.map((e, idx) => 
          idx === update.stepIndex
            ? {
                ...e,
                capabilities: e.capabilities.map(cap =>
                  cap.id === update.capability_id
                    ? { ...cap, status: 'executando' }
                    : cap
                )
              }
            : e
        )
      });
    });

    socket.on('capability:concluiu', (update) => {
      // Atualiza status no card
      updateCardData(cardId, {
        etapas: data.etapas.map((e, idx) => 
          idx === update.stepIndex
            ? {
                ...e,
                capabilities: e.capabilities.map(cap =>
                  cap.id === update.capability_id
                    ? { ...cap, status: 'concluido' }
                    : cap
                )
              }
            : e
        )
      });

      // ADICIONA MENSAGEM DE TEXTO ABAIXO DO CARD
      addMessage({
        type: 'assistant',
        role: 'assistant',
        content: update.mensagem || `ConcluÃ­: ${update.capability_name}`
      });
    });

    socket.on('execution:step:completed', (update) => {
      updateCardData(cardId, {
        etapas: data.etapas.map((e, idx) => 
          idx === update.stepIndex
            ? { ...e, status: 'concluido' }
            : e
        ),
        etapaAtual: update.stepIndex + 1
      });

      // Adiciona mensagem de progresso
      addMessage({
        type: 'assistant',
        role: 'assistant',
        content: `Etapa ${update.stepIndex + 1} concluÃ­da!`
      });
    });

    return () => {
      socket.off('capability:apareceu');
      socket.off('capability:iniciou');
      socket.off('capability:concluiu');
      socket.off('execution:step:completed');
    };
  }, [socket, cardId, data, updateCardData, addMessage]);

  return (
    <motion.div
      layout={isStatic}
      className="developer-mode-card-wrapper"
    >
      <div className="dev-mode-card">
        {/* Header */}
        <div className="dev-mode-header">
          <Wrench className="icon" />
          <h3>MODO DESENVOLVEDOR</h3>
          <span className={`status-badge ${data.status}`}>
            {data.status === 'executando' && 'âš¡ Em execuÃ§Ã£o'}
            {data.status === 'concluido' && 'âœ“ ConcluÃ­do'}
          </span>
        </div>

        {/* Etapas */}
        <div className="dev-mode-steps">
          <AnimatePresence mode="sync">
            {data.etapas.map((etapa, idx) => (
              <motion.div
                key={idx}
                layout
                className={`step-item ${etapa.status}`}
              >
                {/* Ãcone de status */}
                <div className="step-icon">
                  {etapa.status === 'concluido' && <CheckCircle className="text-green-500" />}
                  {etapa.status === 'executando' && <Circle className="text-orange-500" />}
                  {etapa.status === 'pendente' && <Circle className="text-gray-500" />}
                </div>

                {/* TÃ­tulo */}
                <div className="step-content">
                  <p className="step-title">{etapa.titulo}</p>

                  {/* Capabilities (sÃ³ mostra se etapa ativa) */}
                  {etapa.status === 'executando' && etapa.capabilities.length > 0 && (
                    <motion.div
                      initial={{ height: 0 }}
                      animate={{ height: 'auto' }}
                      className="capabilities-list"
                    >
                      {etapa.capabilities.map((cap) => (
                        <div key={cap.id} className="capability-item">
                          <span className="capability-icon">
                            {cap.status === 'executando' && <Loader2 className="animate-spin" size={14} />}
                            {cap.status === 'concluido' && <Check className="text-green-500" size={14} />}
                            {cap.status === 'pendente' && <Clock size={14} />}
                          </span>
                          <span className="capability-name">{cap.nome}</span>
                        </div>
                      ))}
                    </motion.div>
                  )}

                  {/* Badge de status */}
                  {etapa.status === 'concluido' && (
                    <span className="badge-concluido">âœ“ ConcluÃ­do</span>
                  )}
                </div>
              </motion.div>
            ))}
          </AnimatePresence>
        </div>
      </div>
    </motion.div>
  );
}
5. Badge de Progresso Inferior (Inspirado em Manus)
typescript
// interface-modo-producao-chat/components/ProgressBadge.tsx

import { motion, AnimatePresence } from 'framer-motion';
import { useChatState } from '@/state/chatState';

export function ProgressBadge() {
  const devModeCard = useChatState((state) => state.getDevModeCard());

  if (!devModeCard?.metadata?.cardData) return null;

  const data = devModeCard.metadata.cardData;
  const etapaAtual = data.etapaAtual || 0;
  const totalEtapas = data.etapas.length;
  const etapaAtualData = data.etapas[etapaAtual];

  // Se nÃ£o estÃ¡ executando, nÃ£o mostra badge
  if (data.status !== 'executando') return null;

  return (
    <AnimatePresence>
      <motion.div
        initial={{ y: 100, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        exit={{ y: 100, opacity: 0 }}
        className="progress-badge"
      >
        <div className="badge-icon">
          <Loader2 className="animate-spin" size={20} />
        </div>
        
        <p className="badge-text">
          {etapaAtualData?.capabilities[0]?.nome || 'Processando...'}
        </p>

        <div className="badge-counter">
          {etapaAtual + 1} / {totalEtapas}
        </div>

        <button className="badge-expand">
          <ChevronUp size={16} />
        </button>
      </motion.div>
    </AnimatePresence>
  );
}
CSS PARA CARDS ESTÃTICOS
css
/* interface-modo-producao-chat/styles/message-stream.css */

.message-stream {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 24px;
  overflow-y: auto;
  height: 100%;
}

/* Mensagens ficam no fluxo natural */
.message-container {
  width: 100%;
  display: flex;
  flex-direction: column;
}

/* Cards estÃ¡ticos tÃªm largura mÃ¡xima */
.plan-action-card-wrapper,
.developer-mode-card-wrapper,
.activity-construction-card-wrapper {
  width: 100%;
  max-width: 800px;
  margin: 8px 0;
}

/* Cards ficam posicionados como mensagens normais */
.plan-card,
.dev-mode-card {
  background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
  border: 1px solid rgba(249, 115, 22, 0.3);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Badge de progresso inferior fixo */
.progress-badge {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  
  display: flex;
  align-items: center;
  gap: 12px;
  
  background: rgba(249, 115, 22, 0.95);
  backdrop-filter: blur(10px);
  
  padding: 12px 20px;
  border-radius: 24px;
  
  box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
  
  z-index: 100;
}

/* AnimaÃ§Ãµes suaves de layout */
[layout] {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Scroll suave */
.message-stream::-webkit-scrollbar {
  width: 8px;
}

.message-stream::-webkit-scrollbar-thumb {
  background: rgba(249, 115, 22, 0.5);
  border-radius: 4px;
}
FLUXO COMPLETO DE EXECUÃ‡ÃƒO
SequÃªncia de AÃ§Ãµes:
UsuÃ¡rio envia prompt â†’ Mensagem azul Ã  direita

IA responde texto â†’ Mensagem cinza Ã  esquerda: "Ã“timo! Montei um plano..."

Card de Plano aparece â†’ Card estÃ¡tico no fluxo

UsuÃ¡rio clica "APLICAR PLANO" â†’ Card fica na mesma posiÃ§Ã£o

IA adiciona mensagem â†’ "Vou executar o seu plano de aÃ§Ã£o agora" (abaixo do card de plano)

Card Modo Desenvolvedor aparece â†’ Logo abaixo da mensagem anterior

Capabilities aparecem progressivamente â†’ Card Modo Dev atualiza internamente

IA adiciona mensagens de progresso â†’ Mensagens aparecem abaixo do card

Card de ConstruÃ§Ã£o aparece â†’ Quando capability "criar_atividades" Ã© chamada

Mensagens finais â†’ Todas abaixo dos cards

COMPORTAMENTO DE ATUALIZAÃ‡ÃƒO
Cards EstÃ¡ticos vs Mensagens:
Elemento	PosiÃ§Ã£o	AtualizaÃ§Ãµes	Scroll
Mensagem de texto	Fixa no histÃ³rico	Nunca muda	Sim
Card de Plano	Fixa no histÃ³rico	Nunca muda apÃ³s criaÃ§Ã£o	Sim
Card Modo Dev	Fixa no histÃ³rico	Atualiza conteÃºdo interno (capabilities)	Sim
Mensagens de progresso	Abaixo dos cards	Nunca muda	Sim
Badge inferior	Fixa na tela (overlay)	Atualiza em tempo real	NÃ£o (overlay)
IMPLEMENTAÃ‡ÃƒO NO BACKEND (ADICIONAR MENSAGENS)
typescript
// app/api/agente-jota/execute-plan/route.ts

export async function POST(req: NextRequest) {
  const { planData } = await req.json();
  const sessionId = req.headers.get('x-session-id');

  // Inicia executor
  const executor = new PlanExecutor(sessionId);

  await executor.executePlan(planData, {
    onProgress: async (update) => {
      
      // Envia atualizaÃ§Ã£o via WebSocket (atualiza card)
      broadcastToSession(sessionId, update.type, update);

      // ADICIONA MENSAGENS DE TEXTO quando apropriado
      if (update.type === 'capability:concluiu') {
        await addChatMessage(sessionId, {
          type: 'assistant',
          role: 'assistant',
          content: generateProgressMessage(update)
        });
      }

      if (update.type === 'execution:step:completed') {
        await addChatMessage(sessionId, {
          type: 'assistant',
          role: 'assistant',
          content: `Etapa "${update.stepTitle}" concluÃ­da com sucesso! âœ“`
        });
      }

      // Card de ConstruÃ§Ã£o (quando necessÃ¡rio)
      if (update.capability_name === 'criar_atividades') {
        await addChatMessage(sessionId, {
          type: 'construction_card',
          role: 'assistant',
          content: '',
          metadata: {
            cardType: 'construction',
            cardData: update.construction_data,
            isStatic: true
          }
        });
      }
    }
  });

  return NextResponse.json({ success: true });
}

function generateProgressMessage(update: any): string {
  const messages = {
    'pesquisar_atividades_disponiveis': 'Encontrei {total} atividades disponÃ­veis!',
    'decidir_atividades_criar': 'Escolhi {total} atividades estrategicamente',
    'criar_atividades': 'Todas as atividades foram criadas com sucesso!'
  };

  return messages[update.capability_name]?.replace('{total}', update.resultado?.total || '');
}
RESUMO DO COMPORTAMENTO
âœ… Card de Plano: EstÃ¡tico, nunca muda posiÃ§Ã£o ou conteÃºdo
âœ… Card Modo Desenvolvedor: EstÃ¡tico na posiÃ§Ã£o, mas atualiza internamente
âœ… Mensagens de texto: Sempre abaixo dos cards, no fluxo natural
âœ… Badge de progresso: Overlay fixo na parte inferior (opcional)
âœ… Scroll automÃ¡tico: Para Ãºltima mensagem, mas cards ficam no histÃ³rico
âœ… AnimaÃ§Ãµes: Suaves, sem "pulos" ou reposicionamentos bruscos

REFERÃŠNCIAS VISUAIS (MANUS IA)
O comportamento Ã© idÃªntico ao da Manus IA:

Cards ficam "ancorados" no chat como mensagens

Novas mensagens sempre aparecem abaixo

Cards podem atualizar conteÃºdo interno sem mudar posiÃ§Ã£o

Badge inferior mostra progresso em tempo real (opcional)

