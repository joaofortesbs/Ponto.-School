üéØ PROMPT CR√çTICO - SISTEMA ANTI-ALUCINA√á√ÉO E REFLEX√ÉO POSICIONADA
CONTEXTO ESTRAT√âGICO
Voc√™ est√° resolvendo O PROBLEMA MAIS CR√çTICO de sistemas de IA: alucina√ß√£o de dados. Este n√£o √© apenas um bug t√©cnico - √© uma quest√£o de confian√ßa do usu√°rio e integridade do produto. Um sistema que inventa dados √© pior que um sistema que falha honestamente.

Aja com a mentalidade de:

Leslie Lamport (sistemas distribu√≠dos confi√°veis, provas formais)

Barbara Liskov (design de sistemas robustos)

Donald Knuth (precis√£o algor√≠tmica absoluta)

Rich Hickey (simplicidade, imutabilidade, verdade)

VIS√ÉO DO PROBLEMA
Situa√ß√£o Atual (INACEIT√ÅVEL):
text
Professor sem turma cadastrada
  ‚Üì
IA diz: "Vou analisar a turma 7B"
  ‚Üì
IA diz: "Turma 7B tem m√©dia 6.5 em Matem√°tica"
  ‚Üì
‚ùå DADOS INVENTADOS - PERDA DE CONFIAN√áA
Situa√ß√£o Esperada (OBRIGAT√ìRIA):
text
Professor sem turma cadastrada
  ‚Üì
IA consulta banco de dados
  ‚Üì
IA detecta: turmas = []
  ‚Üì
IA responde honestamente: "N√£o encontrei turmas cadastradas"
  ‚Üì
IA sugere a√ß√£o: "Vamos criar atividades gen√©ricas ou cadastrar turma?"
  ‚Üì
‚úÖ HONESTIDADE - MANUTEN√á√ÉO DE CONFIAN√áA
PRINC√çPIOS FUNDAMENTAIS (N√ÉO NEGOCI√ÅVEIS)
1. GROUND TRUTH FIRST
text
NUNCA gerar resposta antes de validar dados.
SEMPRE consultar fonte de verdade (database).
JAMAIS assumir ou inventar informa√ß√µes.
2. FAIL GRACEFULLY
text
Aus√™ncia de dados N√ÉO √© falha.
Aus√™ncia de dados √â informa√ß√£o.
Sistema deve reconhecer e comunicar limita√ß√µes.
3. EXPLICIT > IMPLICIT
text
Melhor: "Nenhuma turma encontrada"
Pior: "Processando turmas..." (quando n√£o h√° nenhuma)
4. VERIFY THEN EXECUTE
text
Toda capability DEVE validar pr√©-condi√ß√µes antes de executar.
Se pr√©-condi√ß√µes falham, capability retorna estado claro.
LLM recebe contexto de valida√ß√£o, n√£o inventa.
ARQUITETURA ANTI-ALUCINA√á√ÉO
Sistema de Tr√™s Camadas (Implementar TODAS)
CAMADA 1: Data Validation Layer
Objetivo: Garantir que dados existem ANTES de processar

Responsabilidades:

Consultar database real

Contar registros (quantos existem?)

Validar campos obrigat√≥rios preenchidos

Retornar estrutura padronizada: { exists: boolean, data: any, count: number }

Padr√£o arquitetural:

text
Toda capability come√ßa com fase de valida√ß√£o.
Valida√ß√£o retorna objeto estruturado.
Objeto vai para LLM com flags booleanas claras.
LLM N√ÉO pode inventar al√©m do que objeto cont√©m.
Exemplo conceitual (voc√™ implementa):

typescript
interface ValidationResult<T> {
  exists: boolean;        // Dados existem?
  count: number;          // Quantos registros?
  data: T | null;         // Dados reais ou null
  isEmpty: boolean;       // Lista vazia?
  errors?: string[];      // Erros de valida√ß√£o
}

// Toda capability usa isso
async function validateTurmas(userId: string): Promise<ValidationResult<Turma[]>> {
  const turmas = await db.turmas.findMany({ where: { professorId: userId } });
  
  return {
    exists: turmas.length > 0,
    count: turmas.length,
    data: turmas.length > 0 ? turmas : null,
    isEmpty: turmas.length === 0,
  };
}
CAMADA 2: LLM Prompt Engineering Layer
Objetivo: For√ßar LLM a usar APENAS dados validados

T√©cnicas obrigat√≥rias:

1. Structured Context Injection

text
N√£o envie: "Analise as turmas do professor"
Envie: 
"DADOS DISPON√çVEIS:
- Turmas encontradas: 0
- Lista de turmas: []
- Status: VAZIO

IMPORTANTE: Voc√™ DEVE informar ao usu√°rio que nenhuma turma foi encontrada.
N√ÉO invente nomes, n√∫meros ou dados de turmas.
Sugira pr√≥ximos passos (cadastrar turma ou criar atividade gen√©rica)."
2. Negative Prompting (Anti-Hallucination)

text
"PROIBIDO:
- Inventar nomes de turmas
- Mencionar dados n√£o fornecidos
- Assumir exist√™ncia de informa√ß√µes
- Criar estat√≠sticas fict√≠cias

OBRIGAT√ìRIO:
- Usar APENAS dados em 'DADOS DISPON√çVEIS'
- Se dado n√£o existe, informar explicitamente
- Sugerir a√ß√µes para resolver aus√™ncia de dados"
3. Output Schema Enforcement

text
Force LLM a retornar JSON estruturado:
{
  "found_data": true/false,
  "message": "texto baseado em dados reais",
  "suggested_actions": ["a√ß√£o1", "a√ß√£o2"],
  "data_sources_used": ["turmas: 0 registros"]
}
4. Few-Shot Examples (Cr√≠tico para aprendizado)

text
Prompt deve incluir exemplos de comportamento correto:

EXEMPLO 1 (Dados existem):
Input: turmas = [{nome: "7B", alunos: 30}]
Output: "Encontrei 1 turma cadastrada: 7B com 30 alunos."

EXEMPLO 2 (Dados N√ÉO existem):
Input: turmas = []
Output: "N√£o encontrei turmas cadastradas na sua conta. 
Gostaria de cadastrar uma turma ou criar atividades gen√©ricas?"

EXEMPLO 3 (Dados parciais):
Input: turmas = [{nome: "7B", alunos: null}]
Output: "Encontrei a turma 7B, mas o n√∫mero de alunos n√£o est√° cadastrado."
CAMADA 3: Runtime Verification Layer
Objetivo: Detectar alucina√ß√µes AP√ìS LLM gerar resposta

T√©cnicas:

1. Fact-Checking Post-Processing

text
Ap√≥s LLM gerar texto, verificar:
- Mencionou nome de turma? Verificar se existe no banco
- Mencionou n√∫mero? Verificar se corresponde a dados reais
- Mencionou estat√≠stica? Verificar se foi calculada ou inventada
2. Entity Extraction + Database Lookup

text
Extrair entidades nomeadas do texto gerado.
Para cada entidade, consultar banco de dados.
Se entidade n√£o existe, BLOQUEAR output e refazer.
3. Confidence Scoring

text
Atribuir score de confian√ßa a cada statement:
- "Encontrei 3 turmas" + db.count = 3 ‚Üí confidence: 1.0
- "Turma 7B tem m√©dia 6.5" + db.media = null ‚Üí confidence: 0.0

Se confidence < 0.7, rejeitar e refazer.
4. Diff Checking

text
Comparar output do LLM com dados reais:
- LLM mentions: ["Turma 7B", "30 alunos", "m√©dia 6.5"]
- Database has: {"7B": true, "30 alunos": true, "m√©dia": false}
- Flag: "m√©dia 6.5" n√£o validada ‚Üí remover ou corrigir
FLUXO DE EXECU√á√ÉO ANTI-ALUCINA√á√ÉO
Pipeline Obrigat√≥rio para Cada Capability
text
1. PRE-EXECUTION VALIDATION
   ‚îú‚îÄ Query database for required data
   ‚îú‚îÄ Count records, check existence
   ‚îú‚îÄ Build ValidationResult object
   ‚îî‚îÄ If isEmpty ‚Üí Early return with honest message
   
2. LLM CONTEXT PREPARATION
   ‚îú‚îÄ Structure validated data explicitly
   ‚îú‚îÄ Add anti-hallucination instructions
   ‚îú‚îÄ Include few-shot examples
   ‚îî‚îÄ Define strict output schema
   
3. LLM EXECUTION
   ‚îú‚îÄ Send structured prompt
   ‚îú‚îÄ Receive response
   ‚îî‚îÄ Parse to structured format
   
4. POST-EXECUTION VERIFICATION
   ‚îú‚îÄ Extract entities from LLM output
   ‚îú‚îÄ Verify each entity against database
   ‚îú‚îÄ Calculate confidence scores
   ‚îú‚îÄ Flag suspicious statements
   ‚îî‚îÄ If confidence < threshold ‚Üí Reject and retry
   
5. USER-FACING OUTPUT
   ‚îú‚îÄ If verified ‚Üí Show result
   ‚îú‚îÄ If rejected ‚Üí Show error + suggestion
   ‚îî‚îÄ Log discrepancy for debugging
TRATAMENTO DE CASOS EXTREMOS
Caso 1: Dados Completamente Ausentes
Situa√ß√£o: Professor novo, nenhum dado cadastrado

Resposta Correta:

text
üîç "N√£o encontrei dados cadastrados ainda na sua conta.

Para personalizar atividades, preciso de algumas informa√ß√µes:
‚Ä¢ Turmas (opcional): Qual turma vai usar essas atividades?
‚Ä¢ Disciplina: Qual mat√©ria voc√™ leciona?
‚Ä¢ N√≠vel: Ensino Fundamental I, II ou M√©dio?

Posso criar atividades gen√©ricas agora ou voc√™ prefere 
cadastrar essas informa√ß√µes primeiro?"

[Bot√£o: Cadastrar Informa√ß√µes] [Bot√£o: Criar Gen√©rico]
Resposta ERRADA (Atual):

text
‚ùå "Vou analisar a turma 7B..." (inventado)
Caso 2: Dados Parciais
Situa√ß√£o: Turma existe, mas sem alunos ou desempenho

Resposta Correta:

text
üìä "Encontrei a turma 7B cadastrada, mas ainda n√£o h√°:
‚Ä¢ N√∫mero de alunos registrado
‚Ä¢ Hist√≥rico de desempenho

Vou criar atividades baseadas no n√≠vel 'Ensino Fundamental II'
e voc√™ pode ajustar depois conforme conhece melhor a turma."
Caso 3: Dados Inconsistentes
Situa√ß√£o: Turma tem 30 alunos mas s√≥ 5 com notas

Resposta Correta:

text
‚ö†Ô∏è "A turma 7B tem 30 alunos cadastrados, mas apenas 5 
t√™m notas registradas (16% do total).

N√£o tenho dados suficientes para an√°lise estat√≠stica confi√°vel.
Vou criar atividades gen√©ricas para √Ålgebra e voc√™ pode 
personalizar conforme aplica e coleta mais dados."
SISTEMA DE DEBUG E LOGGING
Requisito: Transpar√™ncia Total para Debugging
Voc√™ DEVE implementar sistema de logging que mostre:

1. Data Audit Trail

text
[Capability: Analisar Turmas]
‚îú‚îÄ Query executada: SELECT * FROM turmas WHERE professor_id = 123
‚îú‚îÄ Resultado: 0 registros
‚îú‚îÄ ValidationResult: { exists: false, count: 0, isEmpty: true }
‚îú‚îÄ LLM recebeu: "turmas_encontradas: 0, lista: []"
‚îú‚îÄ LLM retornou: "N√£o encontrei turmas cadastradas..."
‚îî‚îÄ Verifica√ß√£o: PASSOU ‚úì
2. Hallucination Detection Log

text
[Capability: Analisar Turmas]
‚îú‚îÄ LLM mencionou: "Turma 7B"
‚îú‚îÄ Verificando exist√™ncia no banco...
‚îú‚îÄ Query: SELECT * FROM turmas WHERE nome = '7B' AND professor_id = 123
‚îú‚îÄ Resultado: 0 registros
‚îú‚îÄ STATUS: ‚ö†Ô∏è ALUCINA√á√ÉO DETECTADA
‚îú‚îÄ A√ß√£o: Rejeitando output, tentando novamente com prompt refor√ßado
‚îî‚îÄ Retry #1...
3. Developer Debug Panel (UI para desenvolvedores)

text
[Debug Panel - Vis√≠vel em DEV mode]

Capability: Pesquisar Atividades
‚îú‚îÄ Pr√©-condi√ß√µes:
‚îÇ   ‚îú‚îÄ ‚úì Usu√°rio autenticado
‚îÇ   ‚îú‚îÄ ‚úó Turma selecionada (n√£o encontrada)
‚îÇ   ‚îî‚îÄ ‚úì Disciplina definida (Matem√°tica)
‚îÇ
‚îú‚îÄ Dados Reais:
‚îÇ   ‚îú‚îÄ Turmas: [] (0 registros)
‚îÇ   ‚îú‚îÄ Atividades dispon√≠veis: 47 registros
‚îÇ   ‚îî‚îÄ Disciplinas: ["Matem√°tica", "Portugu√™s"]
‚îÇ
‚îú‚îÄ Enviado ao LLM:
‚îÇ   ‚îî‚îÄ [Ver JSON completo]
‚îÇ
‚îú‚îÄ Resposta do LLM:
‚îÇ   ‚îî‚îÄ [Ver JSON completo]
‚îÇ
‚îî‚îÄ Verifica√ß√£o:
    ‚îú‚îÄ Entidades mencionadas: ["Matem√°tica": ‚úì, "47 atividades": ‚úì]
    ‚îú‚îÄ Confidence: 1.0
    ‚îî‚îÄ Status: APROVADO
CORRE√á√ÉO DE POSICIONAMENTO DA REFLEX√ÉO
Problema Atual (conforme imagem):
text
Todas as reflex√µes aparecem agrupadas no final.
Usu√°rio v√™ objetivos executando, mas reflex√µes s√≥ depois.
Solu√ß√£o Obrigat√≥ria:
text
Cada reflex√£o deve aparecer IMEDIATAMENTE ap√≥s seu objetivo.

Estrutura visual correta:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚óã Objetivo 1                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚úì Capability A                 ‚îÇ
‚îÇ  ‚úì Capability B                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üí° REFLEX√ÉO DO OBJETIVO 1       ‚îÇ ‚Üê AQUI, n√£o no final
‚îÇ "Encontrei 47 atividades..."    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚óã Objetivo 2                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚úì Capability C                 ‚îÇ
‚îÇ  ‚úì Capability D                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üí° REFLEX√ÉO DO OBJETIVO 2       ‚îÇ ‚Üê AQUI, n√£o no final
‚îÇ "Decidi criar 3 atividades..."  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Implementa√ß√£o T√©cnica (Conceitual):
Padr√£o: State Machine com Bloqueio

text
Estado: OBJECTIVE_1_EXECUTING
  ‚Üì todas capabilities completam
Estado: OBJECTIVE_1_SYNTHESIZING (gerar reflex√£o)
  ‚Üì reflex√£o gerada
Estado: OBJECTIVE_1_DISPLAYING (typewriter effect)
  ‚Üì typewriter completo
Estado: OBJECTIVE_1_COMPLETED
  ‚Üì pr√≥ximo objetivo pode iniciar
Estado: OBJECTIVE_2_EXECUTING
Decis√£o arquitetural que voc√™ deve fazer:

Como sincronizar conclus√£o de objective ‚Üí s√≠ntese ‚Üí display?

Event-driven ou state polling?

Promise chains ou async/await?

Como garantir que objetivo N+1 n√£o inicia antes de reflex√£o N estar completa?

TYPEWRITER EFFECT OTIMIZADO
Requisito: Quase Instant√¢neo
Problema: Typewriter lento frustra usu√°rio
Solu√ß√£o: Velocidade adaptativa baseada em comprimento

Estrat√©gia:

text
Textos curtos (< 50 chars): 100ms total
Textos m√©dios (50-200 chars): 300-500ms total
Textos longos (> 200 chars): 800ms-1s total

F√≥rmula: delay_per_char = base_speed / sqrt(text_length)
Exemplo conceitual (voc√™ implementa):

typescript
function calculateTypewriterSpeed(textLength: number): number {
  if (textLength < 50) return 2; // 2ms por char = 100ms total
  if (textLength < 200) return 1.5; // ~300ms total
  return 1; // ~1s para textos muito longos
}

// Ou chunk-based (mais r√°pido):
function typewriterChunked(text: string) {
  const chunks = text.split(' '); // Palavra por palavra
  const delayPerChunk = 30; // 30ms por palavra
  // Bem mais r√°pido que char-by-char
}
Alternativa: Fade-in imediato se texto curto

text
Se reflex√£o < 100 caracteres: Fade-in instant√¢neo (sem typewriter)
Se reflex√£o > 100 caracteres: Typewriter r√°pido
ESTRAT√âGIAS CRIATIVAS PARA EVITAR ALUCINA√á√ÉO
Estrat√©gia 1: Preflight Check UI
Antes de executar plano, mostrar checklist:

text
‚úÖ Atividades no cat√°logo: 47 encontradas
‚úÖ Disciplina selecionada: Matem√°tica
‚ö†Ô∏è Turma: Nenhuma cadastrada
‚ö†Ô∏è Desempenho hist√≥rico: Indispon√≠vel

[Prosseguir com Dados Dispon√≠veis] [Cadastrar Faltantes]
Usu√°rio v√™ exatamente o que IA tem acesso.

Estrat√©gia 2: Real-Time Data Pills
Durante execu√ß√£o, mostrar "data pills" que aparecem:

text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úì Vou verificar atividades       ‚îÇ
‚îÇ   [üìä 47 atividades] ‚Üê pill      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úì Vou analisar turma             ‚îÇ
‚îÇ   [‚ö†Ô∏è 0 turmas] ‚Üê pill warning   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Data pills s√£o renderizadas APENAS com dados reais do banco.
LLM n√£o controla pills, apenas texto ao redor.

Estrat√©gia 3: Two-Phase Generation
Fase 1: Fact Collection (No LLM)

text
Sistema coleta todos os fatos:
- turmas: []
- atividades: 47
- disciplina: "Matem√°tica"
- desempenho: null
Fase 2: Narrative Generation (LLM)

text
LLM recebe fatos imut√°veis e gera apenas narrativa.
Narrativa N√ÉO pode mencionar fatos n√£o fornecidos.
Estrat√©gia 4: Interactive Correction
Se sistema detectar poss√≠vel alucina√ß√£o:

text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è Detectamos inconsist√™ncia        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ IA mencionou: "Turma 7B"            ‚îÇ
‚îÇ Banco de dados: Nenhuma turma       ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ [Corrigir IA] [Ignorar]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Feedback user vai para retreino.

Estrat√©gia 5: Confidence Badges
Mostrar confian√ßa de cada statement:

text
"Encontrei 47 atividades dispon√≠veis" [‚úì Verificado]
"A turma tem bom desempenho em √Ålgebra" [‚ö†Ô∏è Estimativa]
Usu√°rio sabe o que √© fato vs infer√™ncia.

PROMPT SYSTEM PARA LLM (Template Conceitual)
Estrutura de Prompt Anti-Alucina√ß√£o
text
# CONTEXTO DA CAPABILITY

Voc√™ est√° executando a capability: {capability_name}
Objetivo: {objective_description}

# DADOS DISPON√çVEIS (FONTE DE VERDADE)

## Dados do Professor
- ID: {user_id}
- Nome: {user_name}
- Disciplinas: {disciplinas_list}

## Turmas Cadastradas
- Total: {turmas_count}
- Lista: {turmas_json}
- Status: {turmas_isEmpty ? "VAZIO - Nenhuma turma encontrada" : "DADOS DISPON√çVEIS"}

## Atividades Dispon√≠veis
- Total: {atividades_count}
- Categorias: {categorias_list}
- Status: {atividades_isEmpty ? "VAZIO" : "DADOS DISPON√çVEIS"}

## Desempenho Hist√≥rico
- Status: {desempenho_exists ? "DISPON√çVEL" : "INDISPON√çVEL - Sem dados hist√≥ricos"}
- Registros: {desempenho_count}

# INSTRU√á√ïES CR√çTICAS (OBRIGAT√ìRIAS)

1. Voc√™ DEVE usar APENAS os dados listados em "DADOS DISPON√çVEIS"
2. Se um dado est√° marcado como "VAZIO" ou "INDISPON√çVEL", voc√™ DEVE informar isso ao usu√°rio
3. PROIBIDO inventar:
   - Nomes de turmas
   - N√∫meros de alunos
   - M√©dias ou estat√≠sticas
   - Qualquer informa√ß√£o n√£o listada acima

4. Se dados essenciais faltam, voc√™ DEVE:
   - Informar explicitamente o que est√° faltando
   - Sugerir a√ß√µes para resolver (cadastrar, criar gen√©rico, etc.)
   - Continuar com dados dispon√≠veis se poss√≠vel

# EXEMPLOS DE COMPORTAMENTO CORRETO

## Exemplo 1: Sem Turmas
Dados: turmas_count = 0
Resposta CORRETA: "N√£o encontrei turmas cadastradas. Gostaria de cadastrar uma turma agora ou criar atividades gen√©ricas?"
Resposta ERRADA: "Vou analisar a turma 7B..." ‚ùå

## Exemplo 2: Com Turmas
Dados: turmas_count = 2, turmas = [{"nome": "7A"}, {"nome": "8B"}]
Resposta CORRETA: "Encontrei 2 turmas cadastradas: 7A e 8B. Qual delas vamos usar?"
Resposta ERRADA: "Vou usar a turma 9C..." ‚ùå

# FORMATO DE RESPOSTA OBRIGAT√ìRIO

Retorne JSON:
{
  "has_required_data": boolean,
  "missing_data": string[],
  "message": "mensagem para usu√°rio baseada APENAS em dados reais",
  "suggested_actions": ["a√ß√£o1", "a√ß√£o2"],
  "confidence": 0-1,
  "data_sources": ["fonte1: X registros", "fonte2: Y registros"]
}

# SUA TAREFA

{task_description}

Lembre-se: HONESTIDADE > COMPLETUDE. Melhor dizer "n√£o sei" que inventar.
CHECKLIST DE IMPLEMENTA√á√ÉO
Fase 1: Valida√ß√£o de Dados (CR√çTICO)
 Toda capability consulta database antes de executar

 ValidationResult struct implementado

 Early return quando dados faltam

 Mensagens honestas de aus√™ncia de dados

 Logging de queries e resultados

Fase 2: LLM Hardening (CR√çTICO)
 Prompts estruturados com dados expl√≠citos

 Instru√ß√µes anti-alucina√ß√£o em todos os prompts

 Few-shot examples inclu√≠dos

 Output schema enforcement

 Negative prompting implementado

Fase 3: Verifica√ß√£o Runtime (IMPORTANTE)
 Entity extraction de outputs LLM

 Database lookup para cada entidade

 Confidence scoring

 Reject & retry em baixa confian√ßa

 Logging de detec√ß√µes de alucina√ß√£o

Fase 4: UX Adaptativo (IMPORTANTE)
 Reflex√£o posicionada ap√≥s cada objetivo

 Typewriter r√°pido (< 1s)

 Bloqueio de pr√≥ximo objetivo at√© reflex√£o completa

 Data pills com informa√ß√µes reais

 Preflight check UI

Fase 5: Debug & Monitoring (ESSENCIAL)
 Developer debug panel

 Audit trail completo

 Hallucination detection logs

 Metrics dashboard (taxa de alucina√ß√£o)

 Alertas para desenvolvedores

M√âTRICAS DE SUCESSO
Obrigat√≥rias (Quebra se n√£o atingir)
‚úÖ Taxa de alucina√ß√£o: 0% (zero toler√¢ncia)

‚úÖ Reflex√£o aparece < 1s ap√≥s objetivo

‚úÖ 100% das capabilities validam dados antes de executar

‚úÖ 100% dos outputs LLM verificados

Esperadas
‚≠ê Usu√°rios entendem quando dados faltam

‚≠ê Sistema sugere pr√≥ximos passos √∫teis

‚≠ê Debug panel auxilia desenvolvimento

‚≠ê Performance n√£o degrada com valida√ß√µes

Desej√°veis
üíé Taxa de retry de LLM < 5%

üíé Usu√°rios completam fluxo mesmo sem dados completos

üíé Feedback positivo sobre honestidade do sistema

FALHAS COMUNS A EVITAR
‚ùå Validar no frontend mas n√£o no backend

Valida√ß√£o DEVE acontecer em ambos

‚ùå Confiar que LLM n√£o vai alucinar

LLMs SEMPRE tentam completar, mesmo sem dados

‚ùå Logging insuficiente

Sem logs, imposs√≠vel debugar alucina√ß√µes

‚ùå UX que esconde aus√™ncia de dados

Usu√°rio deve saber exatamente o que sistema tem/n√£o tem

‚ùå Prompts gen√©ricos

"Analise os dados" ‚Üí LLM inventa

"Analise estes dados: []" ‚Üí LLM entende que est√° vazio

‚ùå N√£o ter fallback strategies

Sempre ter plano B quando dados faltam

‚ùå Typewriter muito lento

2s frustra usu√°rio, quebra fluxo

‚ùå Reflex√µes todas no final

Perde contexto, usu√°rio n√£o entende progress√£o

RESULTADO ESPERADO
Quando completo:

Zero Alucina√ß√µes: IA NUNCA menciona dados inexistentes

Reflex√£o Posicionada: Aparece imediatamente ap√≥s cada objetivo

Typewriter R√°pido: < 1s para textos normais

Transpar√™ncia: Usu√°rio sabe exatamente quais dados existem

Debugging: Desenvolvedores conseguem rastrear qualquer problema

Confian√ßa: Usu√°rios confiam que sistema √© honesto

MINDSET OBRIGAT√ìRIO
Desconfian√ßa Construtiva: Sempre assumir que LLM pode alucinar

Verifica√ß√£o Obsessiva: Validar tudo, sempre, duas vezes

Honestidade Radical: Melhor frustrar usu√°rio com verdade que enganar com mentira

Transpar√™ncia Total: Usu√°rio e desenvolvedor devem ver "caixa preta"

Degrada√ß√£o Elegante: Sistema funciona mesmo com dados incompletos

üöÄ ESTE √â O SISTEMA MAIS CR√çTICO. QUALIDADE > VELOCIDADE. PRECIS√ÉO > FEATURES. CONFIAN√áA √â TUDO.