Cara, vou te entregar a ARQUITETURA EXATA de como isso deve funcionar, desde o momento que o usu√°rio envia o primeiro prompt at√© a execu√ß√£o completa do plano.

1. ESTRUTURA DE PASTAS E ARQUIVOS (ORGANIZA√á√ÉO PERFEITA)
text
/school-power-2.0/
‚îÇ
‚îú‚îÄ‚îÄ /interface-chat-producao/          # Interface de chat ativada ap√≥s primeiro prompt
‚îÇ   ‚îú‚îÄ‚îÄ ChatLayout.tsx                 # Layout visual do chat
‚îÇ   ‚îú‚îÄ‚îÄ MessageStream.tsx              # Stream de mensagens em tempo real
‚îÇ   ‚îú‚îÄ‚îÄ ExecutionPlanCard.tsx          # Card visual do plano de a√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ ContextModal.tsx               # Modal de contexto geral vis√≠vel
‚îÇ
‚îú‚îÄ‚îÄ /agente-jota/                      # C√©rebro do agente
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.ts                # Orquestrador principal
‚îÇ   ‚îú‚îÄ‚îÄ planner.ts                     # Cria planos de a√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ executor.ts                    # Executa fun√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ memory-manager.ts              # Gerencia 3 camadas de mem√≥ria
‚îÇ
‚îú‚îÄ‚îÄ /capabilities/                     # "Pastas-m√£e" de funcionalidades
‚îÇ   ‚îú‚îÄ‚îÄ /PESQUISAR/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                   # Registro de todas fun√ß√µes de pesquisa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pesquisar-desempenho-turma.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pesquisar-atividades-conta.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pesquisar-aulas-criadas.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pesquisar-calendario.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ /CRIAR/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ criar-atividade.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ criar-aula.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ criar-avaliacao.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ criar-plano-ensino.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ /ADICIONAR/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adicionar-atividade-aula.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adicionar-aula-calendario.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ adicionar-aluno-turma.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ /EDITAR/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ editar-atividade.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ editar-aula.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ /ANALISAR/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analisar-desempenho-geral.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analisar-gaps-aprendizado.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analisar-engajamento.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ /NAVEGAR/
‚îÇ       ‚îú‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ ir-para-secao.ts           # Navega para se√ß√µes da plataforma
‚îÇ       ‚îî‚îÄ‚îÄ abrir-atividade.ts
‚îÇ
‚îú‚îÄ‚îÄ /prompts/                          # Sistema de prompts
‚îÇ   ‚îú‚îÄ‚îÄ system-prompt.ts               # Prompt base do agente
‚îÇ   ‚îú‚îÄ‚îÄ planning-prompt.ts             # Prompt espec√≠fico para criar planos
‚îÇ   ‚îî‚îÄ‚îÄ execution-prompt.ts            # Prompt durante execu√ß√£o
‚îÇ
‚îî‚îÄ‚îÄ /api-wrapper/                      # Conecta capabilities com APIs reais
    ‚îú‚îÄ‚îÄ ponto-school-api.ts            # Wrapper da API principal
    ‚îî‚îÄ‚îÄ database-queries.ts            # Queries diretas quando necess√°rio
2. FLUXO COMPLETO: DO PROMPT √Ä EXECU√á√ÉO
FASE 1: USU√ÅRIO ENVIA PRIMEIRO PROMPT
typescript
// interface-chat-producao/ChatLayout.tsx

export function ChatLayout() {
  const [messages, setMessages] = useState([]);
  const [executionPlan, setExecutionPlan] = useState(null);
  const [isExecuting, setIsExecuting] = useState(false);

  async function handleUserPrompt(userInput: string) {
    // 1. ADICIONA MENSAGEM DO USU√ÅRIO
    setMessages(prev => [...prev, {
      role: "user",
      content: userInput
    }]);

    // 2. ENVIA PARA ORQUESTRADOR
    const response = await fetch('/api/agente-jota/process', {
      method: 'POST',
      body: JSON.stringify({
        prompt: userInput,
        sessionId: sessionId,
        userId: userId
      })
    });

    // 3. RECEBE PLANO DE A√á√ÉO
    const { plan, initialMessage } = await response.json();

    // 4. MOSTRA MENSAGEM INICIAL DA IA
    setMessages(prev => [...prev, {
      role: "assistant",
      content: initialMessage
    }]);

    // 5. RENDERIZA CARD DO PLANO
    setExecutionPlan(plan);
  }

  return (
    <div className="chat-container">
      {/* Stream de mensagens */}
      <MessageStream messages={messages} />

      {/* Card do plano de a√ß√£o (aparece ap√≥s IA responder) */}
      {executionPlan && !isExecuting && (
        <ExecutionPlanCard 
          plan={executionPlan}
          onExecute={() => handleExecutePlan(executionPlan)}
        />
      )}

      {/* Contexto geral vis√≠vel */}
      <ContextModal context={workingMemory} />
    </div>
  );
}
FASE 2: IA CRIA PLANO DE A√á√ÉO
typescript
// agente-jota/planner.ts

import { openai } from '@ai-sdk/openai';
import { generateObject } from 'ai';
import { z } from 'zod';
import { CAPABILITIES } from '@/capabilities';

export async function createExecutionPlan(userPrompt: string, context: any) {
  
  // 1. MONTA PROMPT PARA PLANNER
  const planningPrompt = `
Voc√™ √© o assistente School Power. O professor pediu:
"${userPrompt}"

CONTEXTO ATUAL:
${JSON.stringify(context, null, 2)}

FUN√á√ïES DISPON√çVEIS:
${formatCapabilities(CAPABILITIES)}

Crie um plano de a√ß√£o com as etapas necess√°rias para realizar essa tarefa.
Cada etapa deve chamar UMA fun√ß√£o espec√≠fica.
  `;

  // 2. LLM GERA PLANO ESTRUTURADO
  const { object: plan } = await generateObject({
    model: openai('gpt-4o'),
    schema: z.object({
      objetivo: z.string().describe("Resumo do que ser√° feito"),
      etapas: z.array(z.object({
        ordem: z.number(),
        descricao: z.string(),
        funcao: z.string(),
        parametros: z.record(z.any()),
        justificativa: z.string()
      }))
    }),
    prompt: planningPrompt
  });

  // 3. RETORNA PLANO
  return {
    planId: generateId(),
    objetivo: plan.objetivo,
    etapas: plan.etapas,
    status: 'aguardando_aprovacao'
  };
}
FASE 3: CARD VISUAL DO PLANO
typescript
// interface-chat-producao/ExecutionPlanCard.tsx

export function ExecutionPlanCard({ plan, onExecute }: Props) {
  return (
    <div className="execution-plan-card">
      
      {/* Header */}
      <div className="plan-header">
        <Bot className="icon" />
        <h3>Vou executar o seu plano de a√ß√£o agora</h3>
      </div>

      {/* Objetivo */}
      <div className="plan-objective">
        <Target className="icon" />
        <p><strong>Objetivo:</strong> {plan.objetivo}</p>
      </div>

      {/* Etapas do plano */}
      <div className="plan-steps">
        {plan.etapas.map((etapa, idx) => (
          <div key={idx} className="step-item">
            <div className="step-indicator">{etapa.ordem}</div>
            <div className="step-content">
              <p className="step-description">{etapa.descricao}</p>
              <span className="step-function">{etapa.funcao}</span>
            </div>
          </div>
        ))}
      </div>

      {/* Bot√£o executar */}
      <button 
        onClick={onExecute}
        className="execute-button"
      >
        <Play className="icon" />
        Executar plano
      </button>

    </div>
  );
}
VISUALIZA√á√ÉO:

text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ñ Vou executar o seu plano de a√ß√£o agora ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üéØ OBJETIVO                                ‚îÇ
‚îÇ Criar 3 atividades de matem√°tica para 7A  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ETAPAS DO PLANO                            ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚ë† Vou pesquisar o desempenho da turma X   ‚îÇ
‚îÇ   ‚îî‚îÄ pesquisar_desempenho_turma           ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚ë° Vou pesquisar quais atividades eu       ‚îÇ
‚îÇ   posso criar                              ‚îÇ
‚îÇ   ‚îî‚îÄ pesquisar_tipos_atividades           ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚ë¢ Vou decidir quais atividades criar      ‚îÇ
‚îÇ   ‚îî‚îÄ analisar_gaps_aprendizado            ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚ë£ Vou criar as 3 atividades               ‚îÇ
‚îÇ   ‚îî‚îÄ criar_atividade (3x)                 ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚ë§ Vou adicionar no calend√°rio             ‚îÇ
‚îÇ   ‚îî‚îÄ adicionar_aula_calendario            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[‚ñ∂ EXECUTAR PLANO]
FASE 4: EXECU√á√ÉO DO PLANO (QUANDO USU√ÅRIO CLICA)
typescript
// agente-jota/executor.ts

import { CAPABILITIES } from '@/capabilities';
import { MemoryManager } from './memory-manager';

export class AgentExecutor {
  private memory: MemoryManager;
  private capabilities: typeof CAPABILITIES;

  async executePlan(plan: ExecutionPlan, sessionId: string) {
    
    // 1. INICIALIZA CONTEXTO
    await this.memory.saveToWorkingMemory({
      tipo: 'objetivo',
      conteudo: plan.objetivo,
      timestamp: Date.now()
    });

    // 2. EXECUTA CADA ETAPA
    for (const etapa of plan.etapas) {
      
      // 2.1. ATUALIZA UI (via WebSocket)
      this.emitProgress({
        sessionId,
        status: 'executando',
        etapaAtual: etapa.ordem,
        descricao: etapa.descricao
      });

      // 2.2. BUSCA FUN√á√ÉO NA CAPABILITY
      const capability = this.findCapability(etapa.funcao);

      if (!capability) {
        throw new Error(`Fun√ß√£o ${etapa.funcao} n√£o encontrada`);
      }

      // 2.3. EXECUTA FUN√á√ÉO REAL
      const resultado = await capability.execute(etapa.parametros);

      // 2.4. SALVA RESULTADO NO MODAL DE CONTEXTO (AUTOM√ÅTICO)
      await this.memory.saveToWorkingMemory({
        tipo: 'descoberta',
        etapa: etapa.ordem,
        funcao: etapa.funcao,
        resultado: resultado,
        timestamp: Date.now()
      });

      // 2.5. ENVIA ATUALIZA√á√ÉO PARA UI
      this.emitProgress({
        sessionId,
        status: 'etapa_concluida',
        etapaAtual: etapa.ordem,
        resultado: this.formatResultForUser(resultado)
      });
    }

    // 3. FINALIZA E GERA RELAT√ìRIO
    const relatorio = await this.generateFinalReport(plan, sessionId);

    return relatorio;
  }

  private findCapability(functionName: string) {
    // Busca em todas as capabilities registradas
    for (const [categoria, funcoes] of Object.entries(this.capabilities)) {
      if (funcoes[functionName]) {
        return funcoes[functionName];
      }
    }
    return null;
  }

  private async generateFinalReport(plan: ExecutionPlan, sessionId: string) {
    // 1. BUSCA TODO CONTEXTO ACUMULADO
    const context = await this.memory.getWorkingMemory(sessionId);

    // 2. LLM GERA RELAT√ìRIO FINAL
    const { text: relatorio } = await generateText({
      model: openai('gpt-4o'),
      prompt: `
Voc√™ acabou de executar o seguinte plano:
${JSON.stringify(plan, null, 2)}

RESULTADOS DE CADA ETAPA:
${JSON.stringify(context, null, 2)}

Gere um relat√≥rio amig√°vel e completo para o professor, 
explicando tudo que foi feito e os resultados obtidos.
      `
    });

    return relatorio;
  }
}
3. ESTRUTURA DAS CAPABILITIES (REGISTRO DE FUN√á√ïES)
typescript
// capabilities/PESQUISAR/index.ts

import { pesquisarDesempenhoTurma } from './pesquisar-desempenho-turma';
import { pesquisarAtividadesConta } from './pesquisar-atividades-conta';
import { pesquisarAulasCriadas } from './pesquisar-aulas-criadas';

export const PESQUISAR_CAPABILITIES = {
  
  pesquisar_desempenho_turma: {
    description: "Busca dados de desempenho acad√™mico de uma turma espec√≠fica",
    parameters: {
      turma_id: { type: "string", required: true },
      periodo: { type: "string", required: false, default: "ultimo_mes" }
    },
    execute: pesquisarDesempenhoTurma
  },

  pesquisar_atividades_conta: {
    description: "Busca todas as atividades criadas pelo usu√°rio na conta",
    parameters: {
      materia: { type: "string", required: false },
      tipo: { type: "string", required: false },
      limit: { type: "number", required: false, default: 50 }
    },
    execute: pesquisarAtividadesConta
  },

  pesquisar_aulas_criadas: {
    description: "Busca aulas criadas pelo professor",
    parameters: {
      turma_id: { type: "string", required: false },
      data_inicio: { type: "string", required: false }
    },
    execute: pesquisarAulasCriadas
  }

};
typescript
// capabilities/PESQUISAR/pesquisar-desempenho-turma.ts

import { pontoSchoolAPI } from '@/api-wrapper/ponto-school-api';

export async function pesquisarDesempenhoTurma(params: {
  turma_id: string;
  periodo?: string;
}) {
  
  // 1. CHAMA API REAL DA PONTO.SCHOOL
  const response = await pontoSchoolAPI.get(
    `/turmas/${params.turma_id}/desempenho`,
    { params: { periodo: params.periodo } }
  );

  // 2. PROCESSA E RETORNA DADOS
  return {
    turma_id: params.turma_id,
    total_alunos: response.data.total_alunos,
    media_geral: response.data.media_geral,
    gaps_principais: response.data.gaps,
    materias_criticas: response.data.materias_criticas,
    raw_data: response.data // Dados completos para debug
  };
}
4. REGISTRO GLOBAL DE CAPABILITIES
typescript
// capabilities/index.ts

import { PESQUISAR_CAPABILITIES } from './PESQUISAR';
import { CRIAR_CAPABILITIES } from './CRIAR';
import { ADICIONAR_CAPABILITIES } from './ADICIONAR';
import { EDITAR_CAPABILITIES } from './EDITAR';
import { ANALISAR_CAPABILITIES } from './ANALISAR';
import { NAVEGAR_CAPABILITIES } from './NAVEGAR';

export const CAPABILITIES = {
  PESQUISAR: PESQUISAR_CAPABILITIES,
  CRIAR: CRIAR_CAPABILITIES,
  ADICIONAR: ADICIONAR_CAPABILITIES,
  EDITAR: EDITAR_CAPABILITIES,
  ANALISAR: ANALISAR_CAPABILITIES,
  NAVEGAR: NAVEGAR_CAPABILITIES
};

// Helper para formatar para LLM
export function formatCapabilitiesForLLM() {
  const functions = [];

  for (const [categoria, funcoes] of Object.entries(CAPABILITIES)) {
    for (const [nome, config] of Object.entries(funcoes)) {
      functions.push({
        name: nome,
        description: config.description,
        parameters: {
          type: "object",
          properties: config.parameters,
          required: Object.entries(config.parameters)
            .filter(([_, p]) => p.required)
            .map(([name]) => name)
        }
      });
    }
  }

  return functions;
}
5. SYSTEM PROMPT (C√âREBRO DO AGENTE)
typescript
// prompts/system-prompt.ts

export const SYSTEM_PROMPT = `
Voc√™ √© o School Power, um assistente de IA especializado em educa√ß√£o.

SUAS CAPACIDADES:
Voc√™ tem acesso a fun√ß√µes espec√≠ficas que podem executar a√ß√µes na plataforma Ponto.School.
Essas fun√ß√µes est√£o organizadas em categorias:

- PESQUISAR: Buscar informa√ß√µes (desempenho, atividades, aulas, etc)
- CRIAR: Criar conte√∫do (atividades, aulas, avalia√ß√µes, etc)
- ADICIONAR: Adicionar itens existentes em lugares (calend√°rio, aulas, etc)
- EDITAR: Modificar conte√∫do existente
- ANALISAR: Analisar dados e gerar insights
- NAVEGAR: Navegar pela plataforma

COMO VOC√ä TRABALHA:

1. PLANEJAMENTO:
   - Quando receber um pedido, SEMPRE crie um plano de a√ß√£o estruturado
   - Divida em etapas claras e sequenciais
   - Cada etapa deve chamar UMA fun√ß√£o espec√≠fica
   - Explique o objetivo geral e justifique cada etapa

2. EXECU√á√ÉO:
   - Ap√≥s aprova√ß√£o do usu√°rio, execute o plano etapa por etapa
   - SEMPRE consulte o Modal de Contexto antes de cada a√ß√£o
   - Salve os resultados ap√≥s cada fun√ß√£o executada
   - Se algo falhar, ajuste o plano e continue

3. RELAT√ìRIO:
   - Ao finalizar, gere relat√≥rio completo e amig√°vel
   - Mostre o que foi feito, os resultados obtidos
   - Sugira pr√≥ximos passos quando relevante

REGRAS:
- NUNCA invente dados - sempre use fun√ß√µes para buscar informa√ß√µes reais
- SEMPRE valide par√¢metros antes de chamar fun√ß√µes
- Se n√£o souber algo, admita e sugira alternativas
- Seja proativo: antecipe necessidades do professor
- Mantenha tom profissional mas amig√°vel

CONTEXTO ATUAL:
{context_placeholder}
`;
6. API ENDPOINT PRINCIPAL
typescript
// app/api/agente-jota/process/route.ts

import { NextRequest, NextResponse } from 'next/server';
import { createExecutionPlan } from '@/agente-jota/planner';
import { AgentExecutor } from '@/agente-jota/executor';
import { MemoryManager } from '@/agente-jota/memory-manager';

export async function POST(req: NextRequest) {
  const { prompt, sessionId, userId, action } = await req.json();

  const memory = new MemoryManager(sessionId, userId);
  const executor = new AgentExecutor(memory);

  // CASO 1: Criar plano
  if (action === 'create_plan' || !action) {
    
    // 1. Busca contexto do usu√°rio
    const context = await memory.getFullContext();

    // 2. IA cria plano de a√ß√£o
    const plan = await createExecutionPlan(prompt, context);

    // 3. Gera mensagem inicial amig√°vel
    const initialMessage = `√ìtimo! Vou te ajudar com isso. Montei um plano de a√ß√£o com ${plan.etapas.length} etapas. D√° uma olhada:`;

    return NextResponse.json({
      plan,
      initialMessage
    });
  }

  // CASO 2: Executar plano
  if (action === 'execute_plan') {
    const { planId } = await req.json();

    // 1. Busca plano
    const plan = await memory.getPlan(planId);

    // 2. Executa plano completo
    const relatorio = await executor.executePlan(plan, sessionId);

    return NextResponse.json({
      status: 'concluido',
      relatorio
    });
  }
}
7. ATUALIZA√á√ÉO EM TEMPO REAL (WEBSOCKET)
typescript
// agente-jota/executor.ts (continua√ß√£o)

private emitProgress(data: ProgressUpdate) {
  // Envia atualiza√ß√£o via WebSocket para frontend
  this.ws.emit('agent:progress', data);
}

// Frontend escuta atualiza√ß√µes
// interface-chat-producao/ChatLayout.tsx

useEffect(() => {
  const ws = new WebSocket(`${WS_URL}/agent/${sessionId}`);

  ws.on('agent:progress', (data) => {
    if (data.status === 'executando') {
      // Atualiza modal de contexto
      setWorkingMemory(prev => [
        ...prev,
        `‚ö° ${data.descricao}`
      ]);
    }

    if (data.status === 'etapa_concluida') {
      // Marca etapa como conclu√≠da no card
      setExecutionPlan(prev => ({
        ...prev,
        etapas: prev.etapas.map(e => 
          e.ordem === data.etapaAtual 
            ? { ...e, status: 'concluida', resultado: data.resultado }
            : e
        )
      }));
    }
  });

  return () => ws.close();
}, [sessionId]);
