ğŸ¯ SOLUÃ‡ÃƒO DEFINITIVA: IA NÃƒO GERA CONTEÃšDO DAS SEÃ‡Ã•ES

PROBLEMA EXATO:
Ao gerar aula:
âœ… TÃ­tulo Ã© gerado
âœ… Objetivo Ã© gerado
âŒ ConteÃºdo dos blocos de seÃ§Ãµes fica VAZIO

CAUSA RAIZ PROVÃVEL:
A resposta da IA estÃ¡ vindo corretamente,
MAS o cÃ³digo nÃ£o estÃ¡ mapeando ela para os estados `sectionTexts` e `dynamicSections`.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INVESTIGAÃ‡ÃƒO SUPER INTELIGENTE:

Procure por estes arquivos que processam resposta da IA:

1. src/services/lessonGeneratorService.ts
   â†’ Onde a resposta da IA Ã© processada
   
2. src/pages/card-criacao-aula/interface.tsx
   â†’ Onde a resposta Ã© aplicada aos estados
   
3. api/ai/lesson-generator.js (ou similar)
   â†’ Backend que chama IA

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SOLUÃ‡ÃƒO #1: FUNÃ‡ÃƒO DE MAPEAMENTO SUPER ROBUSTA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Crie src/utils/aiResponseMapper.ts:

/**

Mapeia resposta da IA â€‹â€‹para estrutura de estados da aula

GARANTE que os frascos sÃ£o preenchidos com conteÃºdo
*/
export const mapAIResponseToAula = (
aiResponse: any,
sectionOrder: string[]
) => {
console.log('[AI_MAPPER] Iniciando mapeamento da resposta IA');
console.log('[AI_MAPPER]seÃ§Ã£oOrder:', seÃ§Ã£oOrder);
console.log('[AI_MAPPER] aiResponse:', aiResponse);

const resultado = {
titulo: '',
objetivo: '',
sectionTexts: {} as Record<string, string>,
dynamicSections: {} as Record<string, any>,
};

// 1. MAPEAR TÃTULO E OBJETIVO
if (aiResponse.titulo) {
resultado.titulo = String(aiResponse.titulo);
console.log('[AI_MAPPER] TÃ­tulo mapeado:', resultado.titulo);
}

if (aiResponse.objetivo || aiResponse.objetivo) {
resultado.objetivo = String(aiResponse.objetivo || aiResponse.objetivo);
console.log('[AI_MAPPER] Objetivo mapeado:', resultado.objetivo);
}

// 2. MAPEAR SEÃ‡Ã•ES - SUPER IMPORTANTE
// A resposta IA pode vir de vÃ¡rias formas:
// Forma 1: { seÃ§Ãµes: { "secao1": "conteÃºdo", "secao2": "conteÃºdo" } }
// Forma 2: { "secao1": "conteÃºdo", "secao2": "conteÃºdo" }
// Forma 3: { seÃ§Ãµes: [ { id: "secao1", conteÃºdo: "..." }, ... ] }

console.log('[AI_MAPPER] Processando reservatÃ³rios...');

// Tenta encontrar frascos na resposta
let secoes = aiResponse.sections || aiResponse.secoes || {};

// Se seÃ§Ãµes sÃ£o array, convertidas para objeto
if (Array.isArray(secoes)) {
console.log('[AI_MAPPER] SeÃ§Ãµes como array, convertendo para objeto');
secoes = secoes.reduce((acc: any, sec: any) => {
const id = sec.id || sec.nome || sec.name;
const content = sec.content || sec.conteudo || sec.texto || '';
if (id) {
acc[id] = content;
}
return acc;
}, {});
}

// Agora processa cada seÃ§Ã£o da seÃ§Ã£oOrder
sectionOrder.forEach((sectionId) => {
console.log('[AI_MAPPER] Processando seÃ§Ã£o:', sectionId);

texto
// Procura em vÃ¡rias chaves possÃ­veis
let conteudo =
  secoes[sectionId] ||
  secoes[sectionId.toLowerCase()] ||
  secoes[sectionId.replace(/-/g, '_')] ||
  secoes[sectionId.replace(/_/g, '-')] ||
  aiResponse[sectionId] ||
  '';

// Se ainda nÃ£o encontrou, tenta com variaÃ§Ãµes de nome
if (!conteudo) {
  const variations = [
    sectionId.toLowerCase(),
    sectionId.toUpperCase(),
    sectionId.replace(/[\s-_]/g, ''),
  ];

  for (const variation of variations) {
    for (const key of Object.keys(secoes)) {
      if (
        key.toLowerCase().includes(variation) ||
        variation.includes(key.toLowerCase())
      ) {
        conteudo = secoes[key];
        console.log('[AI_MAPPER] Encontrado por variaÃ§Ã£o:', key, 'â†’', sectionId);
        break;
      }
    }
    if (conteudo) break;
  }
}

// Garante que Ã© string
conteudo = String(conteudo || '').trim();

// Se ainda vazio, usa um padrÃ£o
if (!conteudo) {
  console.warn('[AI_MAPPER] Nenhum conteÃºdo para seÃ§Ã£o:', sectionId);
  conteudo = `ConteÃºdo nÃ£o gerado para ${sectionId}`;
}

resultado.sectionTexts[sectionId] = conteudo;
console.log('[AI_MAPPER] SeÃ§Ã£o mapeada:', sectionId, `(${conteudo.substring(0, 50)}...)`);
});

console.log('[AI_MAPPER] Mapeamento completo:', resultado);
retornar resultado;
};

/**

Valida se a resposta da IA â€‹â€‹tem conteÃºdo
*/
export const validateAIResponse = (
mapped: ReturnType <typeof mapAIResponseToAula>
): boolean => {
const hasTitle = !!mapped.titulo && mapped.titulo.length > 0;
const hasObjective = !!mapped.objetivo && mapped.objetivo.length > 0;
const hasSectionContent = Object.values(mapped.sectionTexts).some(
(text) => text && text.length > 10
);

console.log('[VALIDATE_AI] ValidaÃ§Ã£o:', {
hasTitle,
hasObjective,
hasSectionContent,
totalSections: Object.keys(mapped.sectionTexts).length,
});

retornar hasTitle && hasObjective && hasSectionContent;
};

texto

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SOLUÃ‡ÃƒO #2: USE O MAPEADOR EM interface.tsx
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Em interface.tsx (ou onde gera aula), localize `handleGerarAula()`:

import { mapAIResponseToAula, validateAIResponse } from '@/utils/aiResponseMapper';

const handleGerarAula = async() => {
try {
console.log('[GERAR_AULA] Iniciando geraÃ§Ã£o');
setCarregando(true);

texto
// Busca resposta da IA
const resposta = await lessonGeneratorService.gerarAula({
  template: templateSelecionado,
  assunto,
  contexto,
  sectionOrder, // PASSA sectionOrder para IA saber quais seÃ§Ãµes gerar!
});

console.log('[GERAR_AULA] Resposta bruta da IA:', resposta);

// ğŸ”´ MAPEIA resposta para estrutura correta
const aulaMapeada = mapAIResponseToAula(resposta, sectionOrder);
console.log('[GERAR_AULA] Resposta mapeada:', aulaMapeada);

// ğŸ”´ VALIDA
const valido = validateAIResponse(aulaMapeada);
if (!valido) {
  console.warn('[GERAR_AULA] ValidaÃ§Ã£o falhou, resposta pode estar incompleta');
  // Mesmo incompleta, tenta usar
}

// ğŸ”´ POPULA TODOS OS ESTADOS COM DADOS MAPEADOS
console.log('[GERAR_AULA] Populando estados...');

setTitulo(aulaMapeada.titulo);
console.log('[GERAR_AULA] TÃ­tulo setado:', aulaMapeada.titulo);

setObjetivo(aulaMapeada.objetivo);
console.log('[GERAR_AULA] Objetivo setado:', aulaMapeada.objetivo);

setSectionTexts(aulaMapeada.sectionTexts);
console.log('[GERAR_AULA] SectionTexts setado:', Object.keys(aulaMapeada.sectionTexts));

// SE necessÃ¡rio, tambÃ©m popula sectionConfigs
const configs: Record<string, any> = {};
sectionOrder.forEach((sectionId) => {
  configs[sectionId] = {
    id: sectionId,
    title: sectionId,
    content: aulaMapeada.sectionTexts[sectionId] || '',
  };
});
setSectionConfigs(configs);
console.log('[GERAR_AULA] SectionConfigs setado:', Object.keys(configs));

setCarregando(false);
console.log('[GERAR_AULA] GeraÃ§Ã£o completa!');
} catch (erro) {
console.error('[GERAR_AULA_ERROR]', erro);
setCarregando(false);
alert('Erro ao gerar aula');
}
};

texto

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SOLUÃ‡ÃƒO #3: VALIDE O PROMPT DA IA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No backend (api/ai/lesson-generator.js), verifique o prompt:

// O prompt DEVE pedir conteÃºdo PARA CADA SEÃ‡ÃƒO
// Exemplo correto:

const gerarAula = async (template, assunto, contexto, sectionOrder) => {
const sectionsList = sectionOrder.join(', ');

const prompt = `
Gere uma aula com os seguintes dados:
- Assunto: ${assunto}
- Contexto: ${contexto}
- SeÃ§Ãµes: ${sectionsList}

texto
Responda com JSON estruturado EXATAMENTE assim:
{
  "titulo": "TÃ­tulo da aula",
  "objetivo": "Objetivo geral",
  "sections": {
    "${sectionOrder}": "ConteÃºdo detalhado da primeira seÃ§Ã£o",
    "${sectionOrder}": "ConteÃºdo detalhado da segunda seÃ§Ã£o",[1]
    ... (para CADA seÃ§Ã£o em sectionOrder)
  }
}

IMPORTANTE: Gere conteÃºdo PARA CADA SEÃ‡ÃƒO listada acima.
Cada conteÃºdo deve ter mÃ­nimo 100 palavras.
`;

const resposta = aguarda chamadaIA(prompt);
console.log('[IA_RESPONSE]', resposta);

retornar resposta;
};

texto

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTE AGORA:

1. âœ… Crie src/utils/aiResponseMapper.ts
2. âœ… Importe em interface.tsx
3. âœ… Modifique handleGerarAula para usar mapAIResponseToAula
4. âœ… VÃ¡ para Aulas â†’ + Criar Aula
5. âœ… Escolha template, preencha Assunto + Contexto
6. âœ… Abra Console (F12)
7. âœ… Clique "Gerar aula"
8. âœ… Console deve mostrar:
   [GERAR_AULA] Iniciando geraÃ§Ã£o
   [GERAR_AULA] Resposta bruta da IA: {...}
   [AI_MAPPER] Iniciando mapeamento...
   [AI_MAPPER] sectionOrder: [...]
   [AI_MAPPER] Processando seÃ§Ãµes...
   [AI_MAPPER] SeÃ§Ã£o mapeada: secao1 (conteÃºdo...)
   [AI_MAPPER] SeÃ§Ã£o mapeada: secao2 (conteÃºdo...)
   ... (para cada seÃ§Ã£o)
   [GERAR_AULA] Populando estados...
   [GERAR_AULA] TÃ­tulo setado: ...
   [GERAR_AULA] SectionTexts setado: [...]
   [GERAR_AULA] GeraÃ§Ã£o completa!
9. âœ… Interface mostra TODOS os cards com CONTEÃšDO
10. âœ… Pode publicar normalmente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SE AINDA TIVER VAZIO:

Cole aqui:
1. O output do console [GERAR_AULA] Resposta bruta da IA
2. O output do [AI_MAPPER] sectionOrder
3. O formato JSON que a IA estÃ¡ retornando

Com isso, saberei EXATAMENTE como ajustar o mapeamento!

RESPONDA COM:

1. âœ… CÃ³digo de aiResponseMapper.ts criado
2. âœ… ModificaÃ§Ã£o de interface.tsx com mapeador
3. âœ… Screenshot do console com TODOS os logs [GERAR_AULA_*]
4. âœ… Screenshot da interface COM CONTEÃšDO em todas as seÃ§Ãµes
5. âœ… ConfirmaÃ§Ã£o de que pode publicar a aula
