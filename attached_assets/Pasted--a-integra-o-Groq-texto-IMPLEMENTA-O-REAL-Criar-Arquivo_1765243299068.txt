 a integra√ß√£o Groq:

texto
üéØ IMPLEMENTA√á√ÉO REAL: Criar Arquivos de Integra√ß√£o Groq (N√ÉO apenas salvar prompts)
===================================================================================

‚ö†Ô∏è A√á√ÉO IMEDIATA: Este prompt vai criar os ARQUIVOS REAIS de c√≥digo que faltaram!

PASSO 1: CRIAR /src/services/groqService.js
==========================================

Crie um novo arquivo em /src/services/groqService.js com EXATAMENTE este conte√∫do:

Importe Groq de 'groq-sdk';

// Valida√ß√£o imediata da chave API
const apiKey = process.env.GROQ_API_KEY?.trim();
if (!apiKey || !apiKey.startsWith('gsk_')) {
throw new Error('‚ùå GROQ_API_KEY inv√°lida! Verifique a vari√°vel de ambiente.');
}

const groq = new Groq({
apiKey: apiKey,
baseURL: ' https://api.groq.com/openai/v1 ',
timeout: 120.0,
maxRetries: 3
});

// Tentar novamente com backoff exponencial
async function withRetryAndTimeout(asyncFn, maxRetries = 3) {
let lastError;
for (let attempt = 0; attempt < maxRetries; attempt++) {
try {
return await asyncFn();
} catch (err) {
lastError = err;
if (err.status === 429 && attempt < maxRetries - 1) {
const waitTime = Math.pow(2, attempt) * 1000;
console.warn( ‚è≥ Rate limited. Waiting ${waitTime}ms...);
await new Promise(r => setTimeout(r, waitTime));
} else if (err.code === 'ECONNREFUSED' && attempt < maxRetries - 1) {
const waitTime = (attempt + 1) * 2000;
console.warn( ‚è≥ Connection refused. Retrying in ${waitTime}ms...);
await new Promise(r => setTimeout(r, waitTime));
} else {
throw err;
}
}
}
lan√ßar √∫ltimoErro;
}

// Fun√ß√£o 1: Gerar Flashcards
export async function generateFlashcards(topic, amount = 5) {
return withRetryAndTimeout(async () => {
const response = await groq.chat.completions.create({
model: 'llama-3.3-70b-versatile',
messages: [
{
role: 'system',
content: 'Voc√™ √© especialista em educa√ß√£o. RESPONDA APENAS EM JSON V√ÅLIDO.'
},
{
role: 'usu√°rio',
conte√∫do: Crie ${quantity} flashcards sobre "${topic}". Formato: [{"pergunta": "...", "resposta": "..."}]
}
],
temperatura: 0,5,
max_tokens: 2000,
top_p: 0,9
});

texto
const content = response.choices?.message?.content;
if (!content || content.trim() === '') {
  console.warn('‚ö†Ô∏è Empty response from model');
  return [];
}

try {
  const jsonStr = content.replace(/```json\n?/g, '').replace(/```
  return JSON.parse(jsonStr);
} catch (err) {
  console.error('‚ùå JSON parse error:', err.message);
  return [];
}
});
}

// Fun√ß√£o 2: Gerar Quiz
export async function generateQuiz(topic, questions = 5) {
return withRetryAndTimeout(async () => {
const response = await groq.chat.completions.create({
model: 'llama-3.3-70b-versatile',
messages: [
{
role: 'system',
content: 'Voc√™ cria quizzes educativos. RESPONDA APENAS EM JSON V√ÅLIDO.'
},
{
role: 'usu√°rio',
conte√∫do: Gere ${questions} quest√µes sobre "${topic}". Formato: [{"pergunta": "...", "opcoes": ["a", "b", "c", "d"], "resposta": "..."}]
}
],
temperatura: 0,3,
max_tokens: 2000,
top_p: 0,9
});

texto
const content = response.choices?.message?.content;
if (!content || content.trim() === '') return [];

try {
  const jsonStr = content.replace(/```json\n?/g, '').replace(/```
  return JSON.parse(jsonStr);
} catch (err) {
  console.error('‚ùå JSON parse error:', err.message);
  return [];
}
});
}

// Fun√ß√£o 3: Gerar Teste
export async function generateTest(topic, questions = 10, difficulty = 'm√©dio') {
return withRetryAndTimeout(async () => {
const response = await groq.chat.completions.create({
model: 'llama-3.3-70b-versatile',
messages: [
{
role: 'system',
content: Voc√™ √© professor. Crie prova com n√≠vel: ${difficulty}
},
{
role: 'user',
content: Crie uma prova com ${questions} quest√µes sobre "${topic}". Inclua gabarito.
}
],
temperature: 0.2,
max_tokens: 3000,
top_p: 0.9
});

texto
const content = response.choices?.message?.content;
return content || 'Erro ao gerar teste.';
});
}

// Fun√ß√£o 4: Chat
export async function chat(userMessage, conversationHistory = []) {
return withRetryAndTimeout(async () => {
const messages = [...conversationHistory, { role: 'user', content: userMessage }];
const response = await groq.chat.completions.create({
model: 'llama-3.3-70b-versatile',
messages: messages,
temperature: 0.7,
max_tokens: 1024,
top_p: 0.9
});

texto
const content = response.choices?.message?.content;
return content || 'Desculpe, n√£o consegui processar sua mensagem.';
});
}

texto

PASSO 2: LOCALIZAR E ATUALIZAR O ARQUIVO QUE CHAMA A IA
========================================================

1. Procure por um arquivo que cont√©m a l√≥gica da School Power (provavelmente em /src/api/ ou /server/)
2. Este arquivo DEVE ter uma rota tipo:
   - /api/generate-activity
   - /api/generate-content
   - /api/school-power
   - OU similar

3. ENCONTRE A LINHA QUE CHAMA A API DE IA (provavelmente est√° usando Google Gemini ou est√° faltando)

4. SUBSTITUA ela por:

// NO TOPO DO ARQUIVO, ADICIONE:
import { generateFlashcards, generateQuiz, generateTest, chat } from '../services/groqService.js';

// NA FUN√á√ÉO QUE PROCESSA O PROMPT DO USU√ÅRIO, ADICIONE L√ìGICA COMO:

fun√ß√£o ass√≠ncrona processUserPrompt(userPrompt, activityType) {
tente {
deixe resultado;

texto
if (activityType === 'flashcards' || userPrompt.includes('flashcard')) {
  result = await generateFlashcards(userPrompt, 5);
} else if (activityType === 'quiz' || userPrompt.includes('quiz')) {
  result = await generateQuiz(userPrompt, 5);
} else if (activityType === 'test' || userPrompt.includes('teste')) {
  result = await generateTest(userPrompt, 10, 'm√©dio');
} else {
  result = await chat(userPrompt, []);
}

return result;
} catch (err) {
console.error('Erro ao processar prompt:', err);
lan√ßar errar;
}
}

texto

PASSO 3: TESTES IMEDIATOS
==========================

Ap√≥s fazer as altera√ß√µes acima:

1. Salve todos os arquivos
2. Reinicie a aplica√ß√£o (Replit vai fazer rebuild automaticamente)
3. V√° para a plataforma Ponto.School e teste novamente:
   - Digite: "Crie 5 flashcards sobre Fotoss√≠ntese"
   - Deve retornar JSON com flashcards (N√ÉO um formul√°rio gen√©rico)

PASSO 4: VERIFICA√á√ÉO NO CONSOLE

1. Abra o Console do Replit
2. Procure por logs tipo:
   - "‚úÖ Conex√£o com Groq: OK"
   - "Resposta do modelo: ..."
3. Se ver erro tipo "Cannot find module 'groq-sdk'":
   - Execute: npm install groq-sdk
   - Re-run a aplica√ß√£o

PASSO 5: SE AINDA N√ÉO FUNCIONAR

1. Verifique se os SECRETS est√£o configurados:
   - GROQ_API_KEY deve estar em Secrets
   - VITE_GROQ_API_KEY tamb√©m deve estar configurado

2. Procure pelo arquivo que chama a IA (pode ser em /server, /api, ou /routes)

3. Se n√£o encontrar, mencione o nome dos arquivos que fazem a chamada da IA e vou indicar exatamente onde colocar o c√≥digo.