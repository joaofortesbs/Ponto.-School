4. Ajustar o Modal da Apostila Inteligente
Atualize o Modal da Apostila Inteligente para carregar e exibir as anotações exportadas do IndexedDB , e adicione uma interface para configurar o tempo de expiração.

Arquivo: src/components/ApostilaInteligenteModal.js
Código:
JavaScript

Copiar
import React, { useState, useEffect } from 'react';
import indexedDBManager from '../utils/indexedDBManager';
import { toast } from 'react-toastify';

const ApostilaInteligenteModal = ({ userId, onClose }) => {
  const [anotacoes, setAnotacoes] = useState([]);
  const [pastas, setPastas] = useState([]);
  const [expirationDays, setExpirationDays] = useState(90);
  const [newExpirationDays, setNewExpirationDays] = useState('');

  useEffect(() => {
    const fetchData = async () => {
      try {
        const expiration = await indexedDBManager.getExpirationDays(userId);
        setExpirationDays(expiration);

        const todasAnotacoes = await indexedDBManager.getAnotacoes(userId);
        const anotacoesExportadas = todasAnotacoes.filter(a => a.data_exportacao);
        setAnotacoes(anotacoesExportadas);

        const pastasSalvas = await indexedDBManager.getPastas(userId);
        setPastas(pastasSalvas);
      } catch (error) {
        toast.error('Erro ao carregar dados: ' + error.message);
      }
    };
    fetchData();
  }, [userId]);

  const handleSetExpiration = async () => {
    try {
      const days = parseInt(newExpirationDays, 10);
      if (isNaN(days) || days < 1) {
        throw new Error('Digite um número de dias válido (maior que 0).');
      }

      await indexedDBManager.saveExpirationDays(userId, days);
      setExpirationDays(days);
      setNewExpirationDays('');
      toast.success(`Tempo de expiração atualizado para ${days} dias!`);
    } catch (error) {
      toast.error(error.message);
    }
  };

  const getPastaNome = (pastaId) => {
    const pasta = pastas.find(p => p.id === pastaId);
    return pasta ? pasta.nome : 'Sem pasta';
  };

  const handleClearData = async () => {
    try {
      await indexedDBManager.clearData(userId);
      setAnotacoes([]);
      setPastas([]);
      setExpirationDays(90); // Resetar para o padrão
      toast.success('Dados temporários limpos com sucesso!');
    } catch (error) {
      toast.error(error.message);
    }
  };

  return (
    <div className="modal">
      <h2>Apostila Inteligente</h2>
      <div>
        <h3>Configurar Tempo de Expiração</h3>
        <p>Tempo atual: {expirationDays} dias</p>
        <input
          type="number"
          placeholder="Digite o número de dias"
          value={newExpirationDays}
          onChange={(e) => setNewExpirationDays(e.target.value)}
        />
        <button onClick={handleSetExpiration}>Atualizar Tempo de Expiração</button>
      </div>
      {anotacoes.length === 0 ? (
        <p>Nenhuma anotação exportada. Crie anotações no Caderno e exporte-as para cá.</p>
      ) : (
        <ul>
          {anotacoes.map(anotacao => (
            <li key={anotacao.id}>
              <h3>{anotacao.titulo}</h3>
              <p>Pasta: {getPastaNome(anotacao.pasta_id)}</p>
              <p>Conteúdo: {anotacao.conteudo}</p>
              <p>Modelo: {anotacao.modelo_anotacao}</p>
              <p>Tags: {anotacao.tags.join(', ')}</p>
              <p>Exportada em: {new Date(anotacao.data_exportacao).toLocaleString()}</p>
              <p>Expira em: {new Date(anotacao.expires_at).toLocaleString()}</p>
            </li>
          ))}
        </ul>
      )}
      <button onClick={handleClearData}>Limpar Dados Temporários</button>
      <button onClick={onClose}>Fechar</button>
    </div>
  );
};

export default ApostilaInteligenteModal;

Mostrar na barra lateral
Validação:

Abra o Modal da Apostila Inteligente e confirme que as anotações exportadas são exibidas corretamente, com dados de expiração visíveis.
No campo "Configurar Tempo de Expiração", insira um novo valor (ex.: 30 dias) e clique em "Atualizar Tempo de Expiração".
Confirme que o tempo de expiração foi atualizado no IndexedDB (verifique no object store preferencias ).
Crie uma nova anotação e exporte-a, confirmando que o expires_at reflete o novo tempo configurado.
5. Testes Finais
Teste 1: Crie uma anotação no Modal de Anotações em Caderno e confirme que ela é salva no IndexedDB com expires_at definido para 90 dias (padrão).
Teste 2: No Modal da Apostila Inteligente, configure o tempo de expiração para 30 dias e confirme que a preferência é salva no IndexedDB .
Teste 3: Crie e exporte uma nova anotação, confirmando que ela tem expires_at definido para 30 dias a partir da criação.
Teste 4: Altere manualmente o expires_at de uma anotação para um dado passado e confirme que ela foi removida ao carregar os dados.
Teste 5: Clique em "Limpar Dados Temporários" e confirme que todos os dados do usuário (anotações, pastas e opções) são removidos do IndexedDB .
Teste 6: Após limpar os dados, confirme que o tempo de expiração volta ao padrão (90 dias).
✅ Resultado Final Esperado

As anotações e pastas são salvas no IndexedDB com um tempo de expiração configurável pelo usuário.
O padrão de expiração é 90 dias se o usuário não configurar um valor.
O Modal de Anotações em Caderno salva anotações com o tempo de expiração correto.
O Modal da Apostila Inteligente exibe apenas anotações exportadas e não expiradas, e permite configurar o tempo de expiração.
O botão "Limpar Dados Temporários" remove todos os dados do usuário e redefine o tempo de expiração para o padrão.