Contexto e Objetivo:

 Em nossa plataforma, queremos que as anota√ß√µes criadas pelos usu√°rios no Modal de Anota√ß√µes em Caderno sejam salvas e exibidas no Modal da Apostila Inteligente, usando o IndexedDB como banco de dados temporariamente no navegador, sem integrar com o Supabase. O IndexedDB ser√° usado para armazenar anota√ß√µes, pastas e prefer√™ncias de cada usu√°rio, identificadas pelo user_id do usu√°rio autenticado. Os dados devem ter um tempo de expira√ß√£o configur√°vel pelo usu√°rio (em dias), usando um campo expires_at para controlar a validade. Se o usu√°rio n√£o configurar o tempo de expira√ß√£o, o padr√£o ser√° de 90 dias. O objetivo √© permitir que os usu√°rios criem anota√ß√µes no Caderno, as exportem para a Apostila Inteligente (associando-as a uma pasta, se desejarem), e as visualizem/editem no Modal da Apostila Inteligente, com a possibilidade de configurar o tempo de expira√ß√£o dos dados.

üß© Detalhamento do Ambiente T√©cnico

Estrutura dos Dados:

Anota√ß√µes:
JavaScript

Copiar
{
  id: "uuid-aleatorio",
  user_id: "id-do-usuario",
  titulo: "T√≠tulo da anota√ß√£o",
  conteudo: "Conte√∫do da anota√ß√£o",
  modelo_anotacao: "Estudo Completo",
  tags: ["tag1", "tag2"],
  data_criacao: "2025-04-29T10:00:00Z",
  data_exportacao: "2025-04-29T10:05:00Z", // null se n√£o exportada
  origem: "caderno",
  pasta_id: null, // null se n√£o associado a uma pasta
  expires_at: "2025-07-28T10:00:00Z" // Expira em 90 dias (padr√£o) ou conforme configurado
}
Massas:
JavaScript

Copiar
{
  id: "uuid-aleatorio",
  user_id: "id-do-usuario",
  nome: "Nome da pasta",
  descricao: "Descri√ß√£o opcional",
  data_criacao: "2025-04-29T10:00:00Z",
  expires_at: "2025-07-28T10:00:00Z" // Expira em 90 dias (padr√£o) ou conforme configurado
}
Prefer√™ncias (Novo Object Store):
JavaScript

Copiar
{
  user_id: "id-do-usuario", // Chave prim√°ria
  expiration_days: 90 // N√∫mero de dias para expira√ß√£o (padr√£o: 90)
}
Configura√ß√£o do IndexedDB :

Nome do Banco de Dados: "anotacoes_db"
Armazenamentos de Objetos (Tabelas):
anotacoes : Armazena as anota√ß√µes, com √≠ndice user_id para consulta por usu√°rio.
pastas : Armazena as pastas, com √≠ndice user_id para consulta por usu√°rio.
prefer√™ncias : Armazena conforme prefer√™ncias de expira√ß√£o do usu√°rio, com user_id como chave prim√°ria.
Chave Prim√°ria: id para anota√ß√µes e pastas ; user_id para prefer√™ncias .
√çndices: user_id para anota√ß√µes e pastas (para filtrar por usu√°rio).
Fluxo da Funcionalidade:

O usu√°rio cria uma anota√ß√£o no Modal de Anota√ß√µes em Caderno e salva no IndexedDB (inicialmente com data_exportacao: null e expires_at definido com base na prefer√™ncia de expira√ß√£o do usu√°rio ou 90 dias como padr√£o).
O usu√°rio clicou em "Salvar na Apostila Inteligente":
Um modal aparece para selecionar ou criar uma pasta.
A anota√ß√£o √© atualizada com data_exportacao e pasta_id .
O usu√°rio que acessa o Modal da Apostila Inteligente:
O modal exibe apenas as anota√ß√µes com data_exportacao n√£o nulo, associadas √†s pastas pelo pasta_id .
Dados expirados (baseados em expires_at ) s√£o filtrados e removidos.
O usu√°rio pode configurar o tempo de expira√ß√£o no Modal da Apostila Inteligente:
Um campo permite definir o n√∫mero de dias para expira√ß√£o (ex.: 30, 60, 90).
A prefer√™ncia √© salvar no IndexedDB e aplicar a todas as anota√ß√µes e pastas criadas a partir desse momento.
üîç Requisitos e Considera√ß√µes

Use o IndexedDB para armazenar os dados temporariamente no navegador.
Garanta que os dados sejam separados por user_id usando √≠ndices no IndexedDB .
Implemente um tempo de expira√ß√£o configur√°vel pelo usu√°rio, com padr√£o de 90 dias, salvo prefer√™ncias de armazenamento de objeto .
Trate erros como falhas na abertura do banco de dados ou opera√ß√µes mal sucedidas.
Adicione uma op√ß√£o para limpar os dados do IndexedDB (bot√£o "Limpar Dados Tempor√°rios").
N√£o integre com o Supabase; tudo deve ser gerenciado localmente no navegador.
‚úÖ Objetivo e Resultado Esperado

Implementar fun√ß√µes para gerenciar anota√ß√µes, pastas e prefer√™ncias no IndexedDB .
Ajustar o Modal de Anota√ß√µes em Caderno para salvar anota√ß√µes no IndexedDB com expira√ß√£o configur√°vel.
Ajustar o Modal da Apostila Inteligente para carregar e exibir as anota√ß√µes exportadas, com uma interface para configurar o tempo de expira√ß√£o.
Certifique-se de que as anota√ß√µes sejam associadas √†s pastas e exibidas corretamente.
Adicionar tratamento de erros e feedback visual para o usu√°rio.
Garanta que os dados expirem conforme a configura√ß√£o do usu√°rio (padr√£o: 90 dias) e sejam removidos automaticamente.