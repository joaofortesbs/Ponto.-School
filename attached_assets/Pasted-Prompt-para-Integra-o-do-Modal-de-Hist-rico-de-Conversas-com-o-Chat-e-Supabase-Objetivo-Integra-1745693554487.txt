Prompt para Integração do Modal de Histórico de Conversas com o Chat e Supabase
Objetivo : 

Integrar o modal de histórico de conversas, previamente criado, com um sistema de chat de conversa em tempo real, de modo que todas as conversas realizadas pelos usuários sejam salvas no banco de dados do Supabase e exibidas no modal. O modal deve exibir apenas as conversas do usuário logado, e as conversas devem ser persistidas no perfil do usuário no Supabase.

Contexto e Estrutura Existente
Você tem um modal de histórico de conversas implementado em um aplicativo web, com a seguinte estrutura e funcionalidades:

Modal de Histórico :
Localizado à esquerda da tela, com um design de tema escuro.
Contém uma barra de pesquisa no topo para filtrar conversas por título.
Um botão "Ações" que exibe um menu suspenso com opções como "Arquivar conversas", "Excluir conversas" e "Exportar histórico".
Um botão "Criar novo chat privado" no topo e no rodapé, que inicia uma nova conversa.
Conversas organizadas em frascos temporais: "Ontem", "Últimos 7 dias" e "Este ano".
Cada conversa exibe um título e um timestamp (ex.: "Há 27 horas" ou "16 de abr.").
Os itens de conversa são clicáveis, e ao clicar, a conversa é marcada como selecionada (com um fundo destacado).
Uma área à direita do modal exibe a mensagem "Selecione uma conversa para pré-visualizar".
Tecnologias Utilizadas :
Frontend: HTML, CSS e JavaScript puro.
Dados simulados: Um array estático conversationsData com objetos contendo title , timestamp e date .
Agora, você precisa integrar esse modal com um sistema de chat funcional, onde:

As conversas realizadas no chat devem ser salvas automaticamente no banco de dados do Supabase, associado ao perfil do usuário logado.
O modal deve exibir apenas as conversas do usuário logado, puxando os dados do Supabase.
O sistema de chat deve ser básico, permitindo que o usuário envie mensagens em tempo real, e essas mensagens devem ser salvas como parte de uma conversa no Supabase.
Requisitos de Integração
Estrutura do Chat de Conversa :
Crie uma área de chat à direita do modal (onde atualmente está uma área de pré-visualização).
A área de bate-papo deve ter:
Um cabeçalho com o título da conversa (o mesmo título exibido no modal).
Uma lista de mensagens, onde as mensagens do usuário aparecem à direita e as respostas (simuladas, para este caso) aparecem à esquerda.
Um campo de entrada de texto na parte inferior para enviar novas mensagens.
Um botão "Enviar" ao lado do campo de entrada.
Quando o usuário clica no botão "Criar novo chat privado", uma nova conversa é iniciada, e o título da conversa deve ser gerado automaticamente com base na primeira mensagem enviada (ex.: se a primeira mensagem for "Como melhorar meu site?", o título pode ser "Otimização de Site").
Quando o usuário clica em uma conversa no modal, a área de chat deve carregar as mensagens dessa conversa.
Integração com Supabase :
Use o Supabase como backend para autenticação de usuários e armazenamento de conversas.
Autenticação :
Implemente um sistema de login simples com Supabase Auth, onde o usuário pode fazer login com email e senha.
Exiba um formulário de login na tela inicial, e só mostre o modal e o chat após o login.
Estrutura do Banco de Dados :
Crie uma tabela de conversas no Supabase com os seguintes campos:
id : UUID (chave primária, gerada automaticamente).
user_id : UUID (referência ao ID do usuário logado, obtido do Supabase Auth).
title : string (título da conversa).
criado_at : timestamp (dados de criação da conversa).
atualizado_at : timestamp (dados da última mensagem, para ordenação).
Crie uma tabela messages no Supabase com os seguintes campos:
id : UUID (chave primária, gerada automaticamente).
conversa_id : UUID (chave estrangeira referenciando conversas.id ).
user_id : UUID (ID do usuário que enviou a mensagem).
content : string (conteúdo da mensagem).
is_user : booleano (indica se a mensagem é do usuário ou uma resposta simulada).
criado_at : timestamp (dados de envio da mensagem).
Políticas de Segurança (RLS) :
Habilitar Row Level Security (RLS) nas tabelas.
Crie políticas para garantir que os usuários possam acessar suas próprias conversas e mensagens:
Para conversas : user_id = auth.uid() .
Para mensagens : conversa_id deve pertencer a uma conversa onde user_id = auth.uid() .
Funcionalidades do Modal :
Substitua o array estático conversationsData por uma chamada ao Supabase para buscar as conversas do usuário logado.
As conversas devem ser ordenadas por update_at (mais recente primeiro) e agrupadas nas coleções temporais ("Ontem", "Últimos 7 dias", "Este ano").
A barra de pesquisa deve filtrar as conversas pelo título, mas a filtragem pode ser feita no frontend.
Ao clicar em uma conversa, as mensagens dessa conversa devem ser transmitidas pelo Supabase e exibidas na área de chat.
Salvamento de Conversas :
Quando o usuário inicia uma nova conversa (clicando em "Criar novo chat privado"):
Crie uma nova entrada na tabela conversas com o user_id do usuário logado e um título temporário (ex.: "Nova Conversa").
Salve o id da nova conversa em uma variável global ou estado.
Quando o usuário envia a primeira mensagem:
Atualize o título da conversa no Supabase com base na primeira mensagem.
Salve a mensagem na tabela messages , associando-a ao conversa_id .
Para cada mensagem enviada:
Salve a mensagem na tabela mensagens .
Atualizar o campo atualizado_at da conversa correspondente na tabela conversas .
Simule uma resposta automática (ex.: "Entendido, estou processando sua solicitação.") e salve essa resposta como uma mensagem na tabela messages com is_user = false .
Design e Experiência do Usuário :
Mantenha o tema escuro consistente com o modal:
Fundo do chat: Preto escuro (#1C2526).
Mensagens do usuário: Fundo escuro cinza (#333333), texto branco, homologados à direita.
Mensagens de resposta: Fundo cinza mais claro (#444444), texto branco, homologados à esquerda.
Campo de entrada: Fundo escuro cinza (#333333), texto branco, bordas arredondadas.
Botão "Enviar": Fundo cinza escuro (#333333), texto branco, bordas arredondadas.
Exiba um indicador de "carregando" (ex.: "Carregando...") enquanto as conversas ou mensagens estão sendo pesquisadas no Supabase.
Passos para Implementação
Configuração do Supabase :
Crie um projeto no Supabase e obtenha as credenciais (URL e chave pública).
Configure o Supabase Auth para autenticação por e-mail/senha.
Crie as tabelas conversas e mensagens no Supabase com os campos referenciais.
Habilite o RLS e configure as políticas de segurança para restringir o acesso.
Autenticação :
Adicione o Supabase JavaScript Client ao projeto via CDN.
Crie um formulário de login na tela inicial com campos para email e senha.
Use supabase.auth.signInWithPassword() para autenticar o usuário.
Após o login, oculte o formulário e exiba o modal e a área de chat.
Estrutura do Chat :
Substitua a área de pré-visualização por uma área de chat com cabeçalho, lista de mensagens e campo de entrada.
Use JavaScript para gerenciar o estado da conversa atual (ex.: currentConversationId ).
Integração do Modal com Supabase :
Modifique a função renderConversations para buscar as conversas do Supabase usando supabase.from('conversations').select('*').eq('user_id', userId) .
Atualizar a lógica de agrupamento para usar o campo atualizado_at das conversas.
Ao clicar em uma conversa, procure as mensagens correspondentes com supabase.from('messages').select('*').eq('conversation_id', convId) e renderize-as na área de chat.
Salvamento de Conversas e Mensagens :
Ao clicar no botão "Criar novo chat privado", insira uma nova conversa no Supabase e armazene o id .
Quando o usuário envia uma mensagem:
Se for a primeira mensagem, atualize o título da conversa.
Insira a mensagem na tabela mensagens .
Atualizar o update_at da conversa.
Simule uma resposta e salve-a no Supabase.
Gestão de Estado :
Use variáveis ​​globais ou um objeto de estado simples para rastrear o usuário logado e a conversa atual.
Atualize o modal dinamicamente sempre que uma nova conversa ou mensagem for adicionada.
Código Base para Integração
Atualizar o código existente do modal para incluir autenticação, integração com Supabase e o sistema de chat. Abaixo está o código revisado com as mudanças possíveis.