<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/images/ponto-school-logo.png"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" content="notranslate" />
    <title>Ponto.School</title>
    <link rel="preload" href="/images/ponto-school-logo.png" as="image" fetchpriority="high" crossorigin="anonymous"/>
    <style>
      .logo-fallback {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        font-weight: bold;
        font-size: 1.5rem;
      }
      .logo-fallback span.orange {
        color: #ff6b00;
        font-size: 1.8rem;
      }
      .logo-fallback span.blue {
        color: #0d00f5;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Configuração global da logo com uma versão e timestamp para evitar cache
      var currentTime = new Date().getTime();
      var logoPath = "/images/ponto-school-logo.png";
      var logoUrl = logoPath + "?v=1&t=" + currentTime;
      
      window.PONTO_SCHOOL_CONFIG = {
        defaultLogo: logoUrl,
        logoLoaded: false,
        logoVersion: 1
      };

      // Inline script para pré-carregar e garantir que a logo esteja disponível
      (function () {
        // Função para salvar a logo no localStorage com garantia
        function saveLogo(logoPath) {
          try {
            localStorage.setItem("customLogo", logoPath);
            localStorage.setItem("sidebarCustomLogo", logoPath);
            localStorage.setItem("pontoSchoolLogo", logoPath);
            localStorage.setItem("logoPreloaded", "true");
            localStorage.setItem("logoVersion", "1");
            window.PONTO_SCHOOL_CONFIG.logoLoaded = true;
            console.log("Logo salva no localStorage com sucesso");
            
            // Notificar imediatamente que a logo está disponível
            document.dispatchEvent(new CustomEvent("logoLoaded", { detail: logoPath }));
          } catch (e) {
            console.warn("Não foi possível salvar a logo no localStorage", e);
          }
        }

        // Salvar a logo imediatamente para garantir disponibilidade
        saveLogo(logoUrl);

        // Pré-carregar a logo com alta prioridade para garantir cache no navegador
        var img = new Image();
        img.src = logoUrl;
        img.fetchPriority = "high";
        img.crossOrigin = "anonymous";
        
        // Definir atributos para melhorar carregamento
        var linkPreload = document.createElement("link");
        linkPreload.rel = "preload";
        linkPreload.href = logoUrl;
        linkPreload.as = "image";
        linkPreload.fetchPriority = "high";
        linkPreload.crossOrigin = "anonymous";
        document.head.appendChild(linkPreload);

        // Quando a imagem carregar, apenas logar o sucesso
        img.onload = function () {
          console.log("Logo carregada com sucesso no script inicial", logoUrl);
        };

        // Se houver erro, tentar novamente com um novo timestamp
        img.onerror = function () {
          console.warn("Erro ao carregar a logo, tentando novamente...");
          var newTimestamp = new Date().getTime();
          var retryUrl = logoPath + "?retry=true&t=" + newTimestamp;
          
          setTimeout(function () {
            var retryImg = new Image();
            retryImg.src = retryUrl;
            retryImg.fetchPriority = "high";
            
            // Já salvar a logo de retry
            saveLogo(retryUrl);
            
            retryImg.onload = function () {
              console.log("Logo carregada com sucesso após retry", retryUrl);
            };
            
            retryImg.onerror = function () {
              console.error("Falha definitiva ao carregar a logo, usando fallback alternativo");
              
              // Usar um caminho alternativo extremamente simples
              var absoluteFallback = "/images/ponto-school-logo.png?absolute=true&t=" + new Date().getTime();
              saveLogo(absoluteFallback);
              
              var finalImg = new Image();
              finalImg.src = absoluteFallback;
              finalImg.fetchPriority = "high";
            };
          }, 300);
        };
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
    <script src="/preload.js"></script>
    <script src="https://api.tempolabs.ai/proxy-asset?url=https://storage.googleapis.com/tempo-public-assets/error-handling.js"></script>
  </body>
</html>